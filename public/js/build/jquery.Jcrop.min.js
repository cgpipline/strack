!function(Be){Be.Jcrop=function(e,t){function g(e){return Math.round(e)+"px"}function b(e){return C.baseClass+"-"+e}function c(e){e=Be(e).offset();return[e.left,e.top]}function n(e){return[e.pageX-se[0],e.pageY-se[1]]}function o(e){C=Be.extend(C,e="object"!=typeof e?{}:e),Be.each(["onChange","onSelect","onRelease","onDblClick"],function(e,t){"function"!=typeof C[t]&&(C[t]=function(){})})}function i(e,t,n){if(se=c(M),he.setCursor("move"===e?e:e+"-resize"),"move"===e)return he.activateHandlers((o=t,fe.watchKeys(),function(e){ue.moveOffset([e[0]-o[0],e[1]-o[1]]),o=e,le.update()}),d,n);var o,i,a,r=ue.getFixed(),s=u(e),t=ue.getCorner(u(s));ue.setPressed(ue.getCorner(s)),ue.setCurrent(t),he.activateHandlers((i=e,a=r,function(e){if(C.aspectRatio)switch(i){case"e":case"w":e[1]=a.y+1;break;case"n":case"s":e[0]=a.x+1}else switch(i){case"e":case"w":e[1]=a.y2;break;case"n":case"s":e[0]=a.x2}ue.setCurrent(e),le.update()}),d,n)}function u(e){switch(e){case"n":return"sw";case"s":case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function w(t){return function(e){return C.disabled||"move"===t&&!C.allowMove||(se=c(M),Y=!0,i(t,n(e)),e.stopPropagation(),e.preventDefault()),!1}}function s(e,t,n){var o=e.width(),i=e.height();n<(i=t<o&&0<t?(o=t)/e.width()*e.height():i)&&0<n&&(o=(i=n)/e.height()*e.width()),E=e.width()/o,W=e.height()/i,e.width(o).height(i)}function v(e){return{x:e.x*E,y:e.y*W,x2:e.x2*E,y2:e.y2*W,w:e.w*E,h:e.h*W}}function d(){var e=ue.getFixed();e.w>C.minSelect[0]&&e.h>C.minSelect[1]?(le.enableHandles(),le.done()):le.release(),he.setCursor(C.allowSelect?"crosshair":"default")}function a(e){if(!C.disabled&&C.allowSelect){Y=!0,se=c(M),le.disableHandles(),he.setCursor("crosshair");var t=n(e);return ue.setPressed(t),le.update(),he.activateHandlers(r,d,"touch"===e.type.substring(0,5)),fe.watchKeys(),e.stopPropagation(),e.preventDefault(),!1}}function r(e){ue.setCurrent(e),le.update()}function y(){var e=Be("<div></div>").addClass(b("tracker"));return k&&e.css({opacity:0,backgroundColor:"white"}),e}function l(e){m([e[0]/E,e[1]/W,e[2]/E,e[3]/W]),C.onSelect.call(Ie,v(ue.getFixed())),le.enableHandles()}function m(e){ue.setPressed([e[0],e[1]]),ue.setCurrent([e[2],e[3]]),le.update()}function h(){C.disabled=!0,le.disableHandles(),le.setCursor("default"),he.setCursor("default")}function f(){C.disabled=!1,x()}function p(e,t,n){t=t||C.bgColor;C.bgFade&&Be.fx.step.hasOwnProperty("backgroundColor")&&C.fadeTime&&!n?e.animate({backgroundColor:t},{queue:!1,duration:C.fadeTime}):e.css("backgroundColor",t)}function x(e){C.allowResize?e?le.enableOnly():le.enableHandles():le.disableHandles(),he.setCursor(C.allowSelect?"crosshair":"default"),le.setCursor(C.allowMove?"move":"default"),C.hasOwnProperty("trueSize")&&(E=C.trueSize[0]/F,W=C.trueSize[1]/H),C.hasOwnProperty("setSelect")&&(l(C.setSelect),le.done(),delete C.setSelect),de.refresh(),C.bgColor!=ae&&(p(C.shade?de.getShades():D,C.shade&&C.shadeColor||C.bgColor),ae=C.bgColor),re!=C.bgOpacity&&(re=C.bgOpacity,C.shade?de.refresh():le.setBgOpacity(re)),A=C.maxSize[0]||0,R=C.maxSize[1]||0,T=C.minSize[0]||0,K=C.minSize[1]||0,C.hasOwnProperty("outerImage")&&(M.attr("src",C.outerImage),delete C.outerImage),le.refresh()}var C=Be.extend({},Be.Jcrop.defaults),S=navigator.userAgent.toLowerCase(),k=/msie/.test(S),z=/msie [1-6]\./.test(S);"object"!=typeof e&&(e=Be(e)[0]),o(t="object"!=typeof t?{}:t);var M,O={border:"none",visibility:"visible",margin:0,padding:0,position:"absolute"},j=Be(e),S=!0;"IMG"==e.tagName?(0!=j[0].width&&0!=j[0].height?(j.width(j[0].width),j.height(j[0].height)):((t=new Image).src=j[0].src,j.width(t.width),j.height(t.height)),(M=j.clone().removeAttr("id").css(O).show()).width(j.width()),M.height(j.height()),j.after(M).hide()):(M=j.css(O).show(),S=!1,null===C.shade&&(C.shade=!0)),s(M,C.boxWidth,C.boxHeight);var F=M.width(),H=M.height(),D=Be("<div />").width(F).height(H).addClass(b("holder")).css({position:"absolute",top:Be(e).css("top"),left:Be(e).css("left")}).insertAfter(j).append(M);C.addClass&&D.addClass(C.addClass);var I=Be("<div />"),B=Be("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),P=Be("<div />").width("100%").height("100%").css("zIndex",320),J=Be("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var e=ue.getFixed();C.onDblClick.call(Ie,e)}).insertBefore(M).append(B,P);S&&(I=Be("<img />").attr("src",M.attr("src")).css(O).width(F).height(H),B.append(I)),z&&J.css({overflowY:"hidden"});var A,R,T,K,E,W,Y,q,L,X,G,N,V,Q,U,Z,$,_,ee,te,ne,oe=C.boundary,ie=y().width(F+2*oe).height(H+2*oe).css({position:"absolute",top:g(-oe),left:g(-oe),zIndex:290}).mousedown(a),ae=C.bgColor,re=C.bgOpacity,se=c(M),ce={createDragger:function(t){return function(e){return C.disabled||"move"===t&&!C.allowMove||(se=c(M),Y=!0,i(t,n(ce.cfilter(e)),!0),e.stopPropagation(),e.preventDefault()),!1}},newSelection:function(e){return a(ce.cfilter(e))},cfilter:function(e){return e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,e},isSupported:De,support:!0===C.touchSupport||!1===C.touchSupport?C.touchSupport:De()},ue=(ne=te=ee=_=0,{flipCoords:Fe,setPressed:function(e){e=je(e),te=_=e[0],ne=ee=e[1]},setCurrent:function(e){e=je(e),Z=e[0]-te,$=e[1]-ne,te=e[0],ne=e[1]},getOffset:function(){return[Z,$]},moveOffset:function(e){var t=e[0],e=e[1];_+t<0&&(t-=t+_),ee+e<0&&(e-=e+ee),H<ne+e&&(e+=H-(ne+e)),F<te+t&&(t+=F-(te+t)),_+=t,te+=t,ee+=e,ne+=e},getCorner:function(e){var t=Oe();switch(e){case"ne":return[t.x2,t.y];case"nw":return[t.x,t.y];case"se":return[t.x2,t.y2];case"sw":return[t.x,t.y2]}},getFixed:Oe}),de=(V=!1,Q=Be("<div />").css({position:"absolute",zIndex:240,opacity:0}),U={top:xe(),left:xe().height(H),right:xe().height(H),bottom:xe()},{update:ye,updateRaw:me,getShades:Me,setBgColor:Se,enable:Ce,disable:ke,resize:function(e,t){U.left.css({height:g(t)}),U.right.css({height:g(t)})},refresh:function(){(C.shade?Ce:ke)(),le.isAwake()&&ze(C.bgOpacity)},opacity:ze}),le=function(){function i(e,t){t=Be("<div />").mousedown(w(e)).css({cursor:e+"-resize",position:"absolute",zIndex:t}).addClass("ord-"+e);return ce.support&&t.bind("touchstart.jcrop",ce.createDragger(e)),P.append(t),t}function e(){var e=ue.getFixed();ue.setPressed([e.x,e.y]),ue.setCurrent([e.x2,e.y2]),t()}function t(e){return c?n(e):void 0}function n(e){var t,n,o=ue.getFixed();t=o.w,n=o.h,J.width(Math.round(t)).height(Math.round(n)),t=o.x,n=o.y,C.shade||I.css({top:g(-n),left:g(-t)}),J.css({top:g(n),left:g(t)}),C.shade&&de.updateRaw(o),c||(J.show(),C.shade?de.opacity(re):a(re,!0),c=!0),(e?C.onSelect:C.onChange).call(Ie,v(o))}function a(e,t,n){(c||t)&&(C.bgFade&&!n?M.animate({opacity:e},{queue:!1,duration:C.fadeTime}):M.css("opacity",e))}function o(){return f=!0,C.allowResize?(P.show(),!0):void 0}function r(){f=!1,P.hide()}function s(e){e?(q=!0,r()):(q=!1,o())}var c,u=370,d={},l={},h={},f=!1;C.dragEdges&&Be.isArray(C.createDragbars)&&function(e){for(var t=0;t<e.length;t++)h[e[t]]=i(e[t],u++).addClass("jcrop-dragbar")}(C.createDragbars),Be.isArray(C.createHandles)&&function(e){for(var t,n,o=0;o<e.length;o++)l[e[o]]=(t=e[o],n=void 0,n=C.handleSize,t=i(t,u++).css({opacity:C.handleOpacity}).addClass(b("handle")),n&&t.width(n).height(n),t)}(C.createHandles),C.drawBorders&&Be.isArray(C.createBorders)&&function(e){for(var t,n,o=0;o<e.length;o++){switch(e[o]){case"n":t="hline";break;case"s":t="hline bottom";break;case"e":t="vline right";break;case"w":t="vline"}d[e[o]]=(n=t,n=Be("<div />").css({position:"absolute",opacity:C.borderOpacity}).addClass(b(n)),B.append(n),n)}}(C.createBorders),Be(document).bind("touchstart.jcrop-ios",function(e){Be(e.currentTarget).hasClass("jcrop-tracker")&&e.stopPropagation()});var p=y().mousedown(w("move")).css({cursor:"move",position:"absolute",zIndex:360});return ce.support&&p.bind("touchstart.jcrop",ce.createDragger("move")),B.append(p),r(),{updateVisible:t,update:n,release:function(){r(),J.hide(),C.shade?de.opacity(1):a(1),c=!1,C.onRelease.call(Ie)},refresh:e,isAwake:function(){return c},setCursor:function(e){p.css("cursor",e)},enableHandles:o,enableOnly:function(){f=!0},showHandles:function(){f&&P.show()},disableHandles:r,animMode:s,setBgOpacity:a,done:function(){s(!1),e()}}}(),he=(X=function(){},G=function(){},(N=C.trackDocument)||ie.mousemove(ge).mouseup(be).mouseout(be),M.before(ie),{activateHandlers:function(e,t,n){return Y=!0,X=e,G=t,n=n,ie.css({zIndex:450}),n?Be(document).bind("touchmove.jcrop",we).bind("touchend.jcrop",ve):N&&Be(document).bind("mousemove.jcrop",ge).bind("mouseup.jcrop",be),!1},setCursor:function(e){ie.css("cursor",e)}}),fe=(L=Be('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}).addClass("jcrop-keymgr"),O=Be("<div />").css({position:"absolute",overflow:"hidden"}).append(L),C.keySupport&&(L.keydown(function(e){if(e.ctrlKey||e.metaKey)return!0;var t=!!e.shiftKey?10:1;switch(e.keyCode){case 37:pe(e,-t,0);break;case 39:pe(e,t,0);break;case 38:pe(e,0,-t);break;case 40:pe(e,0,t);break;case 27:C.allowSelect&&le.release();break;case 9:return!0}return!1}).blur(function(){L.hide()}),z||!C.fixedSupport?(L.css({position:"absolute",left:"-20px"}),O.append(L).insertBefore(M)):L.insertBefore(M)),{watchKeys:function(){C.keySupport&&(L.show(),L.focus())}});function pe(e,t,n){C.allowMove&&(ue.moveOffset([t,n]),le.updateVisible(!0)),e.preventDefault(),e.stopPropagation()}function ge(e){return X(n(e)),!1}function be(e){return e.preventDefault(),e.stopPropagation(),Y&&(Y=!1,G(n(e)),le.isAwake()&&C.onSelect.call(Ie,v(ue.getFixed())),ie.css({zIndex:290}),Be(document).unbind(".jcrop"),X=function(){},G=function(){}),!1}function we(e){return X(n(ce.cfilter(e))),!1}function ve(e){return be(ce.cfilter(e))}function ye(){return me(ue.getFixed())}function me(e){U.top.css({left:g(e.x),width:g(e.w),height:g(e.y)}),U.bottom.css({top:g(e.y2),left:g(e.x),width:g(e.w),height:g(H-e.y2)}),U.right.css({left:g(e.x2),width:g(F-e.x2)}),U.left.css({width:g(e.x)})}function xe(){return Be("<div />").css({position:"absolute",backgroundColor:C.shadeColor||C.bgColor}).appendTo(Q)}function Ce(){V||(V=!0,Q.insertBefore(M),ye(),le.setBgOpacity(1,0,1),I.hide(),Se(C.shadeColor||C.bgColor,1),le.isAwake()?ze(C.bgOpacity,1):ze(1,1))}function Se(e,t){p(Me(),e,t)}function ke(){V&&(Q.remove(),I.show(),V=!1,le.isAwake()?le.setBgOpacity(C.bgOpacity,1,1):(le.setBgOpacity(1,1,1),le.disableHandles()),p(D,0,1))}function ze(e,t){V&&(C.bgFade&&!t?Q.animate({opacity:1-e},{queue:!1,duration:C.fadeTime}):Q.css({opacity:1-e}))}function Me(){return Q.children()}function Oe(){if(!C.aspectRatio)return d=te-_,u=ne-ee,A&&Math.abs(d)>A&&(te=0<d?_+A:_-A),R&&Math.abs(u)>R&&(ne=0<u?ee+R:ee-R),K/W&&Math.abs(u)<K/W&&(ne=0<u?ee+K/W:ee-K/W),T/E&&Math.abs(d)<T/E&&(te=0<d?_+T/E:_-T/E),_<0&&(te-=_,_-=_),ee<0&&(ne-=ee,ee-=ee),te<0&&(_-=te,te-=te),ne<0&&(ee-=ne,ne-=ne),F<te&&(_-=l=te-F,te-=l),H<ne&&(ee-=l=ne-H,ne-=l),F<_&&(ne-=l=_-H,ee-=l),H<ee&&(ne-=l=ee-H,ee-=l),He(Fe(_,ee,te,ne));var e,t,n,o,i=C.aspectRatio,a=C.minSize[0]/E,r=C.maxSize[0]/E,s=C.maxSize[1]/W,c=te-_,u=ne-ee,d=Math.abs(c),l=Math.abs(u);return 0===r&&(r=10*F),0==s&&0,d/l<i?(t=ne,n=l*i,(e=c<0?_-n:n+_)<0?(e=0,o=Math.abs((e-_)/i),t=u<0?ee-o:o+ee):F<e&&(e=F,o=Math.abs((e-_)/i),t=u<0?ee-o:o+ee)):(e=te,o=d/i,(t=u<0?ee-o:ee+o)<0?(t=0,n=Math.abs((t-ee)*i),e=c<0?_-n:n+_):H<t&&(t=H,n=Math.abs(t-ee)*i,e=c<0?_-n:n+_)),_<e?(e-_<a?e=_+a:r<e-_&&(e=_+r),t=ee<t?ee+(e-_)/i:ee-(e-_)/i):e<_&&(_-e<a?e=_-a:r<_-e&&(e=_-r),t=ee<t?ee+(_-e)/i:ee-(_-e)/i),e<0?(_-=e,e=0):F<e&&(_-=e-F,e=F),t<0?(ee-=t,t=0):H<t&&(ee-=t-H,t=H),He(Fe(_,ee,e,t))}function je(e){return e[0]<0&&(e[0]=0),e[1]<0&&(e[1]=0),e[0]>F&&(e[0]=F),e[1]>H&&(e[1]=H),[Math.round(e[0]),Math.round(e[1])]}function Fe(e,t,n,o){var i=e,a=n,r=t,s=o;return n<e&&(i=n,a=e),o<t&&(r=o,s=t),[i,r,a,s]}function He(e){return{x:e[0],y:e[1],x2:e[2],y2:e[3],w:e[2]-e[0],h:e[3]-e[1]}}function De(){var e,t={},n=["touchstart","touchmove","touchend"],o=document.createElement("div");try{for(e=0;e<n.length;e++){var i,a=(i="on"+(i=n[e]))in o;a||(o.setAttribute(i,"return;"),a="function"==typeof o[i]),t[n[e]]=a}return t.touchstart&&t.touchend&&t.touchmove}catch(e){return!1}}ce.support&&ie.bind("touchstart.jcrop",ce.newSelection),P.hide(),x(!0);var Ie={setImage:function(i,a){le.release(),h();var r=new Image;r.onload=function(){var e=r.width,t=r.height,n=C.boxWidth,o=C.boxHeight;M.width(e).height(t),M.attr("src",i),I.attr("src",i),s(M,n,o),F=M.width(),H=M.height(),I.width(F).height(H),ie.width(F+2*oe).height(H+2*oe),D.width(F).height(H),de.resize(F,H),f(),"function"==typeof a&&a.call(Ie)},r.src=i},animateTo:function(e,t){function n(){window.setTimeout(h,a)}var o,i,a,r,s,c,u,d,l,h,f=e[0]/E,p=e[1]/W,g=e[2]/E,b=e[3]/W;q||(o=ue.flipCoords(f,p,g,b),e=[(e=ue.getFixed()).x,e.y,e.x2,e.y2],a=C.animationDelay,r=o[0]-(i=e)[0],s=o[1]-e[1],c=o[2]-e[2],u=o[3]-e[3],d=0,l=C.swingSpeed,f=i[0],p=i[1],g=i[2],b=i[3],le.animMode(!0),h=function(){d+=(100-d)/l,i[0]=Math.round(f+d/100*r),i[1]=Math.round(p+d/100*s),i[2]=Math.round(g+d/100*c),i[3]=Math.round(b+d/100*u),(d=99.8<=d?100:d)<100?(m(i),n()):(le.done(),le.animMode(!1),"function"==typeof t&&t.call(Ie))},n())},setSelect:l,setOptions:function(e){o(e),x()},tellSelect:function(){return v(ue.getFixed())},tellScaled:function(){return ue.getFixed()},setClass:function(e){D.removeClass().addClass(b("holder")).addClass(e)},disable:h,enable:f,cancel:function(){le.done(),he.activateHandlers(null,null)},release:le.release,destroy:function(){D.remove(),j.show(),j.css("visibility","visible"),Be(e).removeData("Jcrop")},focus:fe.watchKeys,getBounds:function(){return[F*E,H*W]},getWidgetSize:function(){return[F,H]},getScaleFactor:function(){return[E,W]},getOptions:function(){return C},ui:{holder:D,selection:J}};return k&&D.bind("selectstart",function(){return!1}),j.data("Jcrop",Ie),Ie},Be.fn.Jcrop=function(e,t){var n;return this.each(function(){if(Be(this).data("Jcrop")){if("api"===e)return Be(this).data("Jcrop");Be(this).data("Jcrop").setOptions(e)}else"IMG"==this.tagName?Be.Jcrop.Loader(this,function(){Be(this).css({display:"block",visibility:"hidden"}),n=Be.Jcrop(this,e),Be.isFunction(t)&&t.call(n)}):(Be(this).css({display:"block",visibility:"hidden"}),n=Be.Jcrop(this,e),Be.isFunction(t)&&t.call(n))}),this},Be.Jcrop.Loader=function(e,t,n){var o=Be(e),i=o[0];o.bind("load.jcloader",function e(){i.complete?(o.unbind(".jcloader"),Be.isFunction(t)&&t.call(i)):window.setTimeout(e,50)}).bind("error.jcloader",function(){o.unbind(".jcloader"),Be.isFunction(n)&&n.call(i)}),i.complete&&Be.isFunction(t)&&(o.unbind(".jcloader"),t.call(i))},Be.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,bgFade:!1,borderOpacity:.4,handleOpacity:.5,handleSize:null,aspectRatio:0,keySupport:!0,createHandles:["n","s","e","w","nw","ne","se","sw"],createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},onRelease:function(){}}}(jQuery);