!function(r){r.fn.wPaint=function(s,o){if("object"==typeof s)o=s;else if("string"==typeof s){var e=[],t=this.each(function(){var t=r(this).data("_wPaint");t&&("clear"==s&&t.clearAll(),"clearUndo"==s?t.clearUndo():"image"==s&&void 0===o?e.push(t.getImage()):"image"==s&&void 0!==o?t.setImage(o,!0):"imageBg"==s&&void 0!==o?t.setBgImage(o):void 0!==r.fn.wPaint.defaultSettings[s]&&(void 0!==o?t.settings[s]=o:e.push(t.settings[s])))});return 1===e.length?e[0]:0<e.length?e:t}return(o=r.extend({},r.fn.wPaint.defaultSettings,o||{})).lineWidthMin=parseInt(o.lineWidthMin),o.lineWidthMax=parseInt(o.lineWidthMax),o.lineWidth=parseInt(o.lineWidth),o.fontSizeMin=parseInt(o.fontSizeMin),o.fontSizeMax=parseInt(o.fontSizeMax),o.fontSize=parseInt(o.fontSize),this.each(function(){var t=r(this),e=jQuery.extend(!0,{},o);if(!document.createElement("canvas").getContext)return t.html("Browser does not support HTML5 canvas, please upgrade to a more modern browser."),!1;if(t.data("_wPaint"))return!1;var n=new a(e,t);n.mainMenu=new l,n.textMenu=new c(n),e.imageBg&&t.append(n.generateBg(t.width(),t.height(),e.imageBg)),t.append(n.generate(t.width(),t.height())),t.append(n.generateTemp()),t.append(n.generateTextInput()),(s.menuDom?r(s.menuDom):t).append(n.mainMenu.generate(n,n.textMenu)).append(n.textMenu.generate(n,n.mainMenu)),n.mainMenu.moveTextMenu(n.mainMenu,n.textMenu),n.mainMenu.set_mode(n.mainMenu,n,e.mode);var i=r("._wPaint_icon").outerHeight(!0)-(parseInt(r("._wPaint_icon").css("paddingTop").split("px")[0])+parseInt(r("._wPaint_icon").css("paddingBottom").split("px")[0]));n.mainMenu.menu.find("._wPaint_fillColorPicker").wColorPicker({mode:"click",initColor:e.fillStyle,buttonSize:i,showSpeed:300,hideSpeed:300,onSelect:function(t){n.settings.fillStyle=t,n.textInput.css({color:t})}}),n.mainMenu.menu.find("._wPaint_strokeColorPicker").wColorPicker({mode:"click",initColor:e.strokeStyle,buttonSize:i,showSpeed:300,hideSpeed:300,onSelect:function(t){n.settings.strokeStyle=t}}),n.mainMenu.setWidth(n,n.mainMenu.menu),n.mainMenu.setWidth(n,n.textMenu.menu),e.image?n.setImage(e.image,!0):n.addUndo(),t.data("_wPaint",n)})};var o=["Rectangle","Ellipse","Line","Text"];function a(t,e){return this.settings=t,this.$elem=e,this.mainMenu=null,this.textMenu=null,this.undoArray=[],this.undoCurrent=-1,this.undoMax=10,this.draw=!1,this.canvas=null,this.ctx=null,this.canvasTemp=null,this.ctxTemp=null,this.canvasBg=null,this.ctxBg=null,this.canvasTempLeftOriginal=null,this.canvasTempTopOriginal=null,this.canvasTempLeftNew=null,this.canvasTempTopNew=null,this.textInput=null,this}function l(t){return this.menu=null,this}function c(t){return this.menu=null,this.docked=!0,this.dockOffsetLeft="vertical"===t.settings.menuOrientation?36:0,this.dockOffsetTop="vertical"===t.settings.menuOrientation?0:36,this}r.fn.wPaint.defaultSettings={mode:"Pencil",lineWidthMin:"0",lineWidthMax:"10",lineWidth:"2",fillStyle:"#FFFFFF",strokeStyle:"#FFFF00",fontSizeMin:"1",fontSizeMax:"11",fontSize:"16",fontFamilyOptions:["Arial","Courier","Times","Trebuchet","Verdana"],fontFamily:"Arial",fontTypeBold:!1,fontTypeItalic:!1,fontTypeUnderline:!1,image:null,imageBg:null,drawDown:null,drawMove:null,drawUp:null,menu:["undo","redo","clear","rectangle","ellipse","line","pencil","text","eraser","fillColor","lineWidth","strokeColor"],menuOrientation:"horizontal",menuOffsetX:5,menuOffsetY:5,menuTitles:{undo:"undo",redo:"redo",clear:"clear",rectangle:"rectangle",ellipse:"ellipse",line:"line",pencil:"pencil",text:"text",eraser:"eraser",fillColor:"fill color",lineWidth:"line width",strokeColor:"stroke color",bold:"bold",italic:"italic",underline:"underline",fontSize:"font size",fontFamily:"font family"},disableMobileDefaults:!1},a.prototype={generate:function(t,e){this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d");var n=this;return r(this.canvas).attr("width",t+"px").attr("height",e+"px").css({position:"absolute",left:0,top:0}).mousedown(function(t){t.preventDefault(),t.stopPropagation(),n.draw=!0,n.callFunc(t,n,"Down")}),r(document).mousemove(function(t){n.draw&&n.callFunc(t,n,"Move")}).mouseup(function(t){n.draw&&(n.draw=!1,n.callFunc(t,n,"Up"))}),this.bindMobile(),r(this.canvas)},bindMobile:function(){r(this.canvas).bind("touchstart touchmove touchend touchcancel",function(){var t=event.changedTouches[0],e="";switch(event.type){case"touchstart":e="mousedown";break;case"touchmove":e="mousemove";break;case"touchend":e="mouseup";break;default:return}var n=document.createEvent("MouseEvent");n.initMouseEvent(e,!0,!0,window,1,t.screenX,t.screenY,t.clientX,t.clientY,!1,!1,!1,!1,0,null),t.target.dispatchEvent(n),event.preventDefault()}),this.settings.disableMobileDefaults&&r(document).bind("touchmove",function(t){t.preventDefault()})},generateTemp:function(){return this.canvasTemp=document.createElement("canvas"),this.ctxTemp=this.canvasTemp.getContext("2d"),r(this.canvasTemp).css({position:"absolute"}).hide(),r(this.canvasTemp)},generateBg:function(t,e,n){return this.canvasBg||(this.canvasBg=document.createElement("canvas"),this.ctxBg=this.canvasBg.getContext("2d"),r(this.canvasBg).attr("id","mofo").css({position:"absolute",left:0,top:0}).attr("width",t).attr("height",e)),this.setBgImage(n),r(this.canvasBg)},generateTextInput:function(){var t=this;return t.textCalc=r("<div></div>").css({display:"none",fontSize:this.settings.fontSize,lineHeight:this.settings.fontSize+"px",fontFamily:this.settings.fontFamily}),t.textInput=r('<textarea class="_wPaint_textInput" spellcheck="false"></textarea>').css({display:"none",position:"absolute",color:this.settings.fillStyle,fontSize:this.settings.fontSize,lineHeight:this.settings.fontSize+"px",fontFamily:this.settings.fontFamily}),t.settings.fontTypeBold&&(t.textInput.css("fontWeight","bold"),t.textCalc.css("fontWeight","bold")),t.settings.fontTypeItalic&&(t.textInput.css("fontStyle","italic"),t.textCalc.css("fontStyle","italic")),t.settings.fontTypeUnderline&&(t.textInput.css("textDecoration","underline"),t.textCalc.css("textDecoration","underline")),r("body").append(t.textCalc),t.textInput},callFunc:function(t,e,n){$e=jQuery.extend(!0,{},t);var i=r(e.canvas).offset();$e.pageX=Math.floor($e.pageX-i.left),$e.pageY=Math.floor($e.pageY-i.top);var s=-1<r.inArray(e.settings.mode,o)?"Shape":e.settings.mode,i=e["draw"+s+n];i&&i($e,e),e.settings["draw"+n]&&e.settings["draw"+n].apply(e,[t,s]),"Text"!==e.settings.mode&&"Up"===n&&this.addUndo()},drawShapeDown:function(t,e){"Text"==e.settings.mode&&(""!=e.textInput.val()&&e.drawTextUp(t,e),e.textInput.css({left:t.pageX-1,top:t.pageY-1,width:0,height:0})),r(e.canvasTemp).css({left:t.pageX,top:t.pageY}).attr("width",0).attr("height",0).show(),e.canvasTempLeftOriginal=t.pageX,e.canvasTempTopOriginal=t.pageY;var n=e["draw"+e.settings.mode+"Down"];n&&n(t,e)},drawShapeMove:function(t,e){var n=e.canvasTempLeftOriginal,i=e.canvasTempTopOriginal,s=e.settings.lineWidth/2,o=(t.pageX<n?t.pageX:n)-("Line"==e.settings.mode?Math.floor(s):0),a=(t.pageY<i?t.pageY:i)-("Line"==e.settings.mode?Math.floor(s):0),n=Math.abs(t.pageX-n)+("Line"==e.settings.mode?e.settings.lineWidth:0),i=Math.abs(t.pageY-i)+("Line"==e.settings.mode?e.settings.lineWidth:0);r(e.canvasTemp).css({left:o,top:a}).attr("width",n).attr("height",i),"Text"==e.settings.mode&&e.textInput.css({left:o-1,top:a-1,width:n,height:i}),e.canvasTempLeftNew=o,e.canvasTempTopNew=a;o=e["draw"+e.settings.mode+"Move"];o&&(a="Line"==e.settings.mode?1:2,t.x=s*a,t.y=s*a,t.w=n-e.settings.lineWidth*a,t.h=i-e.settings.lineWidth*a,e.ctxTemp.fillStyle=e.settings.fillStyle,e.ctxTemp.strokeStyle=e.settings.strokeStyle,e.ctxTemp.lineWidth=e.settings.lineWidth*a,o(t,e))},drawShapeUp:function(t,e){var n;"Text"!=e.settings.mode&&(e.ctx.drawImage(e.canvasTemp,e.canvasTempLeftNew,e.canvasTempTopNew),r(e.canvasTemp).hide(),(n=e["draw"+e.settings.mode+"Up"])&&n(t,e))},drawRectangleMove:function(t,e){e.ctxTemp.beginPath(),e.ctxTemp.rect(t.x,t.y,t.w,t.h),e.ctxTemp.closePath(),e.ctxTemp.stroke(),e.ctxTemp.fill()},drawEllipseMove:function(t,e){var n=t.w/2*.5522848,i=t.h/2*.5522848,s=t.x+t.w,o=t.y+t.h,a=t.x+t.w/2,l=t.y+t.h/2;e.ctxTemp.beginPath(),e.ctxTemp.moveTo(t.x,l),e.ctxTemp.bezierCurveTo(t.x,l-i,a-n,t.y,a,t.y),e.ctxTemp.bezierCurveTo(a+n,t.y,s,l-i,s,l),e.ctxTemp.bezierCurveTo(s,l+i,a+n,o,a,o),e.ctxTemp.bezierCurveTo(a-n,o,t.x,l+i,t.x,l),e.ctxTemp.closePath(),0<e.settings.lineWidth&&e.ctxTemp.stroke(),e.ctxTemp.fill()},drawLineMove:function(t,e){var n=e.canvasTempLeftOriginal,i=e.canvasTempTopOriginal;t.pageX<n&&(t.x=t.x+t.w,t.w=-1*t.w),t.pageY<i&&(t.y=t.y+t.h,t.h=-1*t.h),e.ctxTemp.lineJoin="round",e.ctxTemp.beginPath(),e.ctxTemp.moveTo(t.x,t.y),e.ctxTemp.lineTo(t.x+t.w,t.y+t.h),e.ctxTemp.closePath(),e.ctxTemp.stroke()},drawPencilDown:function(t,e){e.ctx.lineJoin="round",e.ctx.lineCap="round",e.ctx.strokeStyle=e.settings.strokeStyle,e.ctx.fillStyle=e.settings.strokeStyle,e.ctx.lineWidth=e.settings.lineWidth,e.ctx.beginPath(),e.ctx.arc(t.pageX,t.pageY,e.settings.lineWidth/2,0,2*Math.PI,!0),e.ctx.closePath(),e.ctx.fill(),e.ctx.beginPath(),e.ctx.moveTo(t.pageX,t.pageY)},drawPencilMove:function(t,e){e.ctx.lineTo(t.pageX,t.pageY),e.ctx.stroke()},drawPencilUp:function(t,e){e.ctx.closePath()},drawTextDown:function(t,e){e.textInput.val("").show().focus()},drawTextUp:function(t,e){t&&this.addUndo();var n="";e.settings.fontTypeItalic&&(n+="italic "),e.settings.fontTypeBold&&(n+="bold "),n+=e.settings.fontSize+"px "+e.settings.fontFamily;for(var i=e.textInput.val().split("\n"),s=[],o=e.textInput.width()-2,a=0,l=0,c=0,r=i.length;c<r;c++){e.textCalc.html("");for(var l=0,d=0,u=i[0].length;d<u;d++)o<(a=e.textCalc.append(i[c][d]).width())&&(s.push(i[c].substring(l,d)),l=d,e.textCalc.html(i[c][d]));l!=d&&s.push(i[c].substring(l,d))}for(var i=e.textInput.val(s.join("\n")).val().split("\n"),t=e.textInput.position(),p=t.left,h=t.top,c=0,r=i.length;c<r;c++)if(e.ctx.fillStyle=e.settings.fillStyle,e.ctx.textBaseline="top",e.ctx.font=n,e.ctx.fillText(i[c],p,h),h+=e.settings.fontSize,""!=i[c]&&e.settings.fontTypeUnderline){for(var a=e.textCalc.html(i[c]).width(),g=e.ctx.getImageData(0,h+0,a,1),d=0;d<g.width*g.height*4;d+=4)g.data[d]=parseInt(e.settings.fillStyle.substring(1,3),16),g.data[d+1]=parseInt(e.settings.fillStyle.substring(3,5),16),g.data[d+2]=parseInt(e.settings.fillStyle.substring(5,7),16),g.data[d+3]=255;e.ctx.putImageData(g,p,h+0)}},drawEraserDown:function(t,e){e.ctx.save(),e.ctx.globalCompositeOperation="destination-out",e.drawPencilDown(t,e)},drawEraserMove:function(t,e){e.drawPencilMove(t,e)},drawEraserUp:function(t,e){e.drawPencilUp(t,e),e.ctx.restore()},getImage:function(){return this.canvasSave=document.createElement("canvas"),this.ctxSave=this.canvasSave.getContext("2d"),r(this.canvasSave).css({display:"none",position:"absolute",left:0,top:0}).attr("width",r(this.canvas).attr("width")).attr("height",r(this.canvas).attr("height")),this.canvasBg&&this.ctxSave.drawImage(this.canvasBg,0,0),this.ctxSave.drawImage(this.canvas,0,0),this.canvasSave.toDataURL()},setImage:function(t,e){var n=this,i=new Image;i.src=t.toString(),n.ctx.clearRect(0,0,n.canvas.width,n.canvas.height),r(i).load(function(){n.ctx.drawImage(i,0,0),e&&n.addUndo()})},setBgImage:function(t,e){var n=this,i=new Image;i.src=t.toString(),n.ctxBg.clearRect(0,0,n.canvasBg.width,n.canvasBg.height),r(i).load(function(){n.ctxBg.drawImage(i,0,0)})},addUndo:function(){for(this.undoCurrent<this.undoArray.length-1?this.undoArray[++this.undoCurrent]=this.getImage():(this.undoArray.push(this.getImage()),this.undoArray.length>this.undoMax?this.undoArray=this.undoArray.slice(1,this.undoArray.length):this.undoCurrent++);this.undoCurrent!=this.undoArray.length-1;)this.undoArray.pop();this.undoToggleIcons()},setUndoImage:function(){this.setImage(this.undoArray[this.undoCurrent])},undoNext:function(){this.undoArray[this.undoCurrent+1]&&(this.undoCurrent++,this.setUndoImage()),this.undoToggleIcons()},undoPrev:function(){this.undoArray[this.undoCurrent-1]&&(this.undoCurrent--,this.setUndoImage()),this.undoToggleIcons()},undoToggleIcons:function(){var t=this.mainMenu.menu.find("._wPaint_undo"),e=this.mainMenu.menu.find("._wPaint_redo");0<this.undoCurrent&&1<this.undoArray.length?t.hasClass("uactive")||t.addClass("uactive"):t.removeClass("uactive"),this.undoCurrent<this.undoArray.length-1?e.hasClass("uactive")||e.addClass("uactive"):e.removeClass("uactive")},clearAll:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.addUndo()},clearUndo:function(){this.undoArray=[],this.undoCurrent=-1,this.undoToggleIcons()}},l.prototype={generate:function(t,e){var n=t;this.textMenu=e;for(var i=this,s="",o=n.settings.lineWidthMin;o<=n.settings.lineWidthMax;o++)s+='<option value="'+Strack.number_add_zero(o,2)+'" '+(n.settings.lineWidth==o?'selected="selected"':"")+">"+Strack.number_add_zero(o,2)+"</option>";var a=r('<div class="_wPaint_lineWidth _wPaint_dropDown" title="'+n.settings.menuTitles.lineWidth+'"></div>').append(r("<select>"+s+"</select>").change(function(t){n.settings.lineWidth=parseInt(r(this).val())})),l=r('<div class="_wPaint_options"></div>');return r.each(n.settings.menu,function(t,e){switch(e){case"undo":l.append(r('<div class="_wPaint_icon _wPaint_undo" title="'+n.settings.menuTitles.undo+'"><i class="icon-uniE98D"></i></div>').click(function(){n.undoPrev()}));break;case"redo":l.append(r('<div class="_wPaint_icon _wPaint_redo" title="'+n.settings.menuTitles.redo+'"><i class="icon-uniE98E"></i></div></div>').click(function(){n.undoNext()}));break;case"clear":l.append(r('<div class="_wPaint_icon _wPaint_clear" title="'+n.settings.menuTitles.clear+'"><i class="icon-uniE9D5"></i></div>').click(function(){n.clearAll()}));break;case"rectangle":l.append(r('<div class="_wPaint_icon _wPaint_rectangle" title="'+n.settings.menuTitles.rectangle+'"><i class="icon-uniEA7C"></i></div>').click(function(){i.set_mode(i,n,"Rectangle")}));break;case"ellipse":l.append(r('<div class="_wPaint_icon _wPaint_ellipse" title="'+n.settings.menuTitles.ellipse+'"><i class="icon-uniEA7F"></i></div>').click(function(){i.set_mode(i,n,"Ellipse")}));break;case"line":l.append(r('<div class="_wPaint_icon _wPaint_line" title="'+n.settings.menuTitles.line+'"><i class="icon-uniEA34"></i></div>').click(function(){i.set_mode(i,n,"Line")}));break;case"pencil":l.append(r('<div class="_wPaint_icon _wPaint_pencil" title="'+n.settings.menuTitles.pencil+'"><i class="icon-uniF1FC"></i></div>').click(function(){i.set_mode(i,n,"Pencil")}));break;case"text":l.append(r('<div class="_wPaint_icon _wPaint_text" title="'+n.settings.menuTitles.text+'"><i class="icon-uniE6FA"></i></div>').click(function(){i.set_mode(i,n,"Text")}));break;case"eraser":l.append(r('<div class="_wPaint_icon _wPaint_eraser" title="'+n.settings.menuTitles.eraser+'"><i class="icon-uniF12D"></i></div>').click(function(t){i.set_mode(i,n,"Eraser")}));break;case"fillColor":l.append(r('<div class="_wPaint_fillColorPicker _wPaint_colorPicker" title="'+n.settings.menuTitles.fillColor+'"></div>'));break;case"lineWidth":l.append(a);break;case"strokeColor":l.append(r('<div class="_wPaint_strokeColorPicker _wPaint_colorPicker" title="'+n.settings.menuTitles.strokeColor+'r"></div>'))}}),this.menu=r('<div class="_wPaint_menu _wPaint_menu_'+n.settings.menuOrientation+'"></div>').css({left:n.settings.menuOffsetX+4,top:0}).append(l)},moveTextMenu:function(t,e){e.docked&&e.menu.css({left:parseInt(t.menu.css("left"))+e.dockOffsetLeft,top:parseInt(t.menu.css("top"))+e.dockOffsetTop})},set_mode:function(t,e,n){"Text"==(e.settings.mode=n)?(t.textMenu.menu.show(),t.setWidth(e,t.textMenu.menu)):(e.drawTextUp(null,e),t.textMenu.menu.hide(),e.textInput.hide()),t.menu.find("._wPaint_icon").removeClass("active"),t.menu.find("._wPaint_"+n.toLowerCase()).addClass("active")},setWidth:function(t,e){var n,i=e.find("._wPaint_options");"vertical"===t.settings.menuOrientation?(n=e.find("._wPaint_options > div:first").outerWidth(!0),n+=i.outerWidth(!0)-i.width()):(n=e.outerWidth(!0)-e.width(),e.find("._wPaint_options").children().each(function(){n+=r(this).outerWidth(!0)})),e.width(n)}},c.prototype={generate:function(t,e){for(var n=t,i=this,s="",o=4,a=n.settings.fontSizeMin;a<=n.settings.fontSizeMax;a++)o+=4,s+='<option value="'+Strack.number_add_zero(o,2)+'" '+(n.settings.fontSize==a?'selected="selected"':"")+">"+Strack.number_add_zero(o,2)+"</option>";for(var l=r('<div class="_wPaint_fontSize _wPaint_dropDown" title="'+n.settings.menuTitles.fontSize+'"></div>').append(r("<select>"+s+"</select>").change(function(t){var e=parseInt(r(this).val());n.settings.fontSize=e,n.textInput.css({fontSize:e,lineHeight:e+"px"}),n.textCalc.css({fontSize:e,lineHeight:e+"px"})})),s="",a=0,c=n.settings.fontFamilyOptions.length;a<c;a++)s+='<option value="'+n.settings.fontFamilyOptions[a]+'" '+(n.settings.fontFamily==n.settings.fontFamilyOptions[a]?'selected="selected"':"")+">"+n.settings.fontFamilyOptions[a]+"</option>";t=r('<div class="_wPaint_fontFamily _wPaint_dropDown" title="'+n.settings.menuTitles.fontFamily+'"></div>').append(r("<select>"+s+"</select>").change(function(t){var e=r(this).val();n.settings.fontFamily=e,n.textInput.css({fontFamily:e}),n.textCalc.css({fontFamily:e})})),t=r('<div class="_wPaint_options"></div>').append(r('<div class="_wPaint_icon _wPaint_bold '+(n.settings.fontTypeBold?"active":"")+'" title="'+n.settings.menuTitles.bold+'"><i class="icon-uniF032"></i></div>').click(function(){i.setType(i,n,"Bold")})).append(r('<div class="_wPaint_icon _wPaint_italic '+(n.settings.fontTypeItalic?"active":"")+'" title="'+n.settings.menuTitles.italic+'"><i class="icon-uniF033"></i></div>').click(function(){i.setType(i,n,"Italic")})).append(r('<div class="_wPaint_icon _wPaint_underline '+(n.settings.fontTypeUnderline?"active":"")+'" title="'+n.settings.menuTitles.underline+'"><i class="icon-uniEA8C"></i></div>').click(function(){i.setType(i,n,"Underline")})).append(l).append(t),r(n.canvas).offset();return this.menu=r('<div class="_wPaint_menu _wPaint_menu_bgc  _wPaint_menu_'+n.settings.menuOrientation+'""></div>').css({display:"none",position:"absolute"}).append(t)},setType:function(t,e,n){var i=t.menu.find("._wPaint_"+n.toLowerCase()),t=i.hasClass("active");e.settings["fontType"+n]=!t,t?i.removeClass("active"):i.addClass("active"),fontTypeBold=e.settings.fontTypeBold?"bold":"normal",fontTypeItalic=e.settings.fontTypeItalic?"italic":"normal",fontTypeUnderline=e.settings.fontTypeUnderline?"underline":"none",e.textInput.css({fontWeight:fontTypeBold}),e.textCalc.css({fontWeight:fontTypeBold}),e.textInput.css({fontStyle:fontTypeItalic}),e.textCalc.css({fontStyle:fontTypeItalic}),e.textInput.css({textDecoration:fontTypeUnderline}),e.textCalc.css({textDecoration:fontTypeUnderline})}}}(jQuery),function(a){function s(t,e){return this.colorPicker=null,this.settings=t,this.$elem=e,this.currentColor=t.initColor,this.height=null,this.width=null,this.slideTopToBottom=null,this.customTarget=null,this.buttonColor=null,this.paletteHolder=null,this}a.fn.wColorPicker=function(e,i){if("object"==typeof e)i=e;else if("string"==typeof e){var n=[],t=this.each(function(){var t=a(this).data("_wColorPicker");t&&void 0!==a.fn.wColorPicker.defaultSettings[e]&&(void 0!==i?t.settings[e]=i:n.push(t.settings[e]))});return 1===n.length?n[0]:0<n.length?n:t}return i=a.extend({},a.fn.wColorPicker.defaultSettings,i||{}),this.each(function(){var t=a(this),e=jQuery.extend(!0,{},i),n=new s(e,t);n.generate(),n.appendToElement(t),n.colorSelect(n,e.initColor),t.data("_wColorPicker",n)})},a.fn.wColorPicker.defaultSettings={theme:"black",opacity:.8,initColor:"#FF0000",onMouseover:null,onMouseout:null,onSelect:null,mode:"flat",buttonSize:20,effect:"slide",showSpeed:500,hideSpeed:500},s.prototype={generate:function(){if(this.colorPicker)return this.colorPicker;var n=this,t={clear:"both",height:0,lineHeight:0,fontSize:0};this.customTarget=a('<div class="_wColorPicker_customTarget"></div>'),this.customInput=a('<input type="text" class="_wColorPicker_customInput" value=""/>').keyup(function(t){var e=t.keyCode||t.which,t=n.validHex(a(this).val());a(this).val(t),7==t.length&&n.customTarget.css("backgroundColor",t),13==e&&(n.colorSelect(n,a(this).val()),n.buttonColor&&n.hidePalette(n))}).click(function(t){t.stopPropagation()});var e=a('<div class="_wColorPicker_custom"></div>').append(this.appendColors(a('<div class="_wColorPicker_noColor">'),[""],1)).append(this.customTarget).append(this.customInput).append(a("<div></div>").css(t)),i=this.appendColors(a('<div class="_wColorPicker_palette_simple"></div>'),["000000","333333","666666","999999","CCCCCC","FFFFFF","FF0000","00FF00","0000FF","FFFF00","00FFFF","FF00FF"],1),s=this.appendColors(a('<div class="_wColorPicker_palette_mixed"></div>'),["000000","003300","006600","009900","00CC00","00FF00","330000","333300","336600","339900","33CC00","33FF00","660000","663300","666600","669900","66CC00","66FF00","000033","003333","006633","009933","00CC33","00FF33","330033","333333","336633","339933","33CC33","33FF33","660033","663333","666633","669933","66CC33","66FF33","000066","003366","006666","009966","00CC66","00FF66","330066","333366","336666","339966","33CC66","33FF66","660066","663366","666666","669966","66CC66","66FF66","000099","003399","006699","009999","00CC99","00FF99","330099","333399","336699","339999","33CC99","33FF99","660099","663399","666699","669999","66CC99","66FF99","0000CC","0033CC","0066CC","0099CC","00CCCC","00FFCC","3300CC","3333CC","3366CC","3399CC","33CCCC","33FFCC","6600CC","6633CC","6666CC","6699CC","66CCCC","66FFCC","0000FF","0033FF","0066FF","0099FF","00CCFF","00FFFF","3300FF","3333FF","3366FF","3399FF","33CCFF","33FFFF","6600FF","6633FF","6666FF","6699FF","66CCFF","66FFFF","990000","993300","996600","999900","99CC00","99FF00","CC0000","CC3300","CC6600","CC9900","CCCC00","CCFF00","FF0000","FF3300","FF6600","FF9900","FFCC00","FFFF00","990033","993333","996633","999933","99CC33","99FF33","CC0033","CC3333","CC6633","CC9933","CCCC33","CCFF33","FF0033","FF3333","FF6633","FF9933","FFCC33","FFFF33","990066","993366","996666","999966","99CC66","99FF66","CC0066","CC3366","CC6666","CC9966","CCCC66","CCFF66","FF0066","FF3366","FF6666","FF9966","FFCC66","FFFF66","990099","993399","996699","999999","99CC99","99FF99","CC0099","CC3399","CC6699","CC9999","CCCC99","CCFF99","FF0099","FF3399","FF6699","FF9999","FFCC99","FFFF99","9900CC","9933CC","9966CC","9999CC","99CCCC","99FFCC","CC00CC","CC33CC","CC66CC","CC99CC","CCCCCC","CCFFCC","FF00CC","FF33CC","FF66CC","FF99CC","FFCCCC","FFFFCC","9900FF","9933FF","9966FF","9999FF","99CCFF","99FFFF","CC00FF","CC33FF","CC66FF","CC99FF","CCCCFF","CCFFFF","FF00FF","FF33FF","FF66FF","FF99FF","FFCCFF","FFFFFF"],18),o=a('<div class="_wColorPicker_bg"></div>').css({opacity:this.settings.opacity}),t=a('<div class="_wColorPicker_content"></div>').append(e).append(i).append(s).append(a("<div></div>").css(t));return this.colorPicker=a('<div class="_wColorPicker_holder"></div>').click(function(t){t.stopPropagation()}).append(a('<div class="_wColorPicker_outer"></div>').append(a('<div class="_wColorPicker_inner"></div>').append(o).append(t))).addClass("_wColorPicker_"+this.settings.theme),this.colorPicker},appendColors:function(t,e,n){var i=1,s=this;for(index in e)t.append(a('<div id="_wColorPicker_color_'+i+'" class="_wColorPicker_color _wColorPicker_color_'+i+'"></div>').css("backgroundColor","#"+e[index]).click(function(){s.colorSelect(s,a(this).css("backgroundColor"))}).mouseout(function(t){s.colorHoverOff(s,a(this))}).mouseover(function(){s.colorHoverOn(s,a(this))})),i==n&&(t.append(a("<div></div>").css({clear:"both",height:0,fontSize:0,lineHeight:0,marginTop:-1})),i=0),i++;return t},colorSelect:function(t,e){e=t.toHex(e),t.customTarget.css("backgroundColor",e),t.currentColor=e,t.customInput.val(e),t.settings.onSelect&&t.settings.onSelect.apply(this,[e]),t.buttonColor&&(t.buttonColor.css("backgroundColor",e),t.hidePalette(t))},colorHoverOn:function(t,e){e.parent().children("active").removeClass("active"),e.addClass("active").next().addClass("activeLeft"),e.nextAll("."+e.attr("id")+":first").addClass("activeTop");e=t.toHex(e.css("backgroundColor"));t.customTarget.css("backgroundColor",e),t.customInput.val(e),t.settings.onMouseover&&t.settings.onMouseover.apply(this,[e])},colorHoverOff:function(t,e){e.removeClass("active").next().removeClass("activeLeft"),e.nextAll("."+e.attr("id")+":first").removeClass("activeTop"),t.customTarget.css("backgroundColor",t.currentColor),t.customInput.val(t.currentColor),t.settings.onMouseout&&t.settings.onMouseout.apply(this,[t.currentColor])},appendToElement:function(t){var e,n=this;"flat"==n.settings.mode?t.append(n.colorPicker):(n.paletteHolder=a('<div class="_wColorPicker_paletteHolder"></div>').css({position:"absolute",overflow:"hidden",width:1e3}).append(n.colorPicker),n.buttonColor=a('<div class="_wColorPicker_buttonColor"></div>').css({width:n.settings.buttonSize,height:n.settings.buttonSize}),e=a('<div class="_wColorPicker_buttonHolder"></div>').css({position:"relative"}).append(a('<div class="_wColorPicker_buttonBorder"></div>').append(n.buttonColor)).append(n.paletteHolder),t.append(e),n.width=n.colorPicker.outerWidth(!0),n.height=n.colorPicker.outerHeight(!0),n.paletteHolder.css({width:280,height:280}).hide(),"fade"==n.settings.effect&&n.paletteHolder.css({opacity:0}),"hover"==n.settings.mode?e.hover(function(t){n.showPalette(t,n)},function(t){n.hidePalette(n)}):"click"==n.settings.mode&&(a(document).click(function(){n.paletteHolder.hasClass("active")&&n.hidePalette(n)}),e.click(function(t){t.stopPropagation(),n.paletteHolder.hasClass("active")?n.hidePalette(n):n.showPalette(t,n)})),n.colorSelect(n,n.settings.initColor))},showPalette:function(t,e){var n=e.paletteHolder.parent().offset(),i=0,s=e.paletteHolder.parent().outerHeight(!0);e.slideTopToBottom=s,n.left-a(window).scrollLeft()+e.width>a(window).width()&&(i=-1*(e.width-e.paletteHolder.parent().outerWidth(!0))),n.top-a(window).scrollTop()+e.height>a(window).height()&&(e.slideTopToBottom=0,s=-1*e.height),e.paletteHolder.css({left:i,top:s}),e.paletteHolder.addClass("active"),"slide"==e.settings.effect?e.paletteHolder.stop(!0,!1).css({height:0,top:0==e.slideTopToBottom?0:s}).show().animate({height:280,top:s},e.settings.showSpeed):"fade"==e.settings.effect?e.paletteHolder.stop(!0,!1).show().animate({opacity:1},e.settings.showSpeed):e.paletteHolder.show()},hidePalette:function(t){t.paletteHolder.hasClass("active")&&(t.paletteHolder.removeClass("active"),"slide"==t.settings.effect?t.paletteHolder.stop(!0,!1).animate({height:0,top:0==t.slideTopToBottom?0:t.slideTopToBottom},t.settings.hideSpeed,function(){t.paletteHolder.hide()}):"fade"==t.settings.effect?t.paletteHolder.stop(!0,!1).animate({opacity:0},t.settings.hideSpeed,function(){t.paletteHolder.hide()}):t.paletteHolder.hide())},toHex:function(t){if("rgba"===t.substring(0,4))n="transparent";else if("rgb"===t.substring(0,3)){var e=t.substring(4,t.length-1).replace(/\s/g,"").split(",");for(i in e)e[i]=parseInt(e[i]).toString(16),"0"==e[i]&&(e[i]="00");var n="#"+e.join("").toUpperCase()}else n=t;return n},validHex:function(t){return"#"+t.replace(/[^0-9a-f]/gi,"").substring(0,6).toUpperCase()}}}(jQuery);