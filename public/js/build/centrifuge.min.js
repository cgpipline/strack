!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("Centrifuge",[],t):"object"==typeof exports?exports.Centrifuge=t():e.Centrifuge=t()}(this,function(){"use strict";var n={382:function(e,t,h){Object.defineProperty(t,"__esModule",{value:!0}),t.Centrifuge=void 0;var i=n(h(187)),o=n(h(471)),u=h(147),c=h(853);function n(e){return e&&e.__esModule?e:{default:e}}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _(n){var s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=r(n);return e=s?(e=r(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),t=this,!(e=e)||"object"!==a(e)&&"function"!=typeof e?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}}function r(e){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var d="timeout",p="connection closed",s=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(r,i["default"]);var e,t,n,s=_(r);function r(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(n=s.call(this))._url=e,n._websocket=null,n._sockjs=null,n._isSockjs=!1,n._xmlhttprequest=null,n._binary=!1,n._methodType=null,n._pushType=null,n._encoder=null,n._decoder=null,n._status="disconnected",n._reconnect=!0,n._reconnecting=!1,n._transport=null,n._transportName=null,n._transportClosed=!0,n._messageId=0,n._clientID=null,n._refreshRequired=!1,n._subs={},n._serverSubs={},n._lastSeq={},n._lastGen={},n._lastOffset={},n._lastEpoch={},n._messages=[],n._isBatching=!1,n._isSubscribeBatching=!1,n._privateChannels={},n._numRefreshFailed=0,n._refreshTimeout=null,n._pingTimeout=null,n._pongTimeout=null,n._subRefreshTimeouts={},n._retries=0,n._callbacks={},n._latency=null,n._latencyStart=null,n._connectData=null,n._token=null,n._xhrID=0,n._xhrs={},n._dispatchPromise=Promise.resolve(),n._config={debug:!1,name:"",version:"",websocket:null,sockjs:null,xmlhttprequest:null,minRetry:1e3,maxRetry:2e4,timeout:5e3,ping:!0,pingInterval:25e3,pongWaitTimeout:5e3,privateChannelPrefix:"$",onTransportClose:null,sockjsServer:null,sockjsTransports:["websocket","xdr-streaming","xhr-streaming","eventsource","iframe-eventsource","iframe-htmlfile","xdr-polling","xhr-polling","iframe-xhr-polling","jsonp-polling"],refreshEndpoint:"/centrifuge/refresh",refreshHeaders:{},refreshParams:{},refreshData:{},refreshAttempts:null,refreshInterval:1e3,onRefreshFailed:null,onRefresh:null,subscribeEndpoint:"/centrifuge/subscribe",subscribeHeaders:{},subscribeParams:{},subRefreshInterval:1e3,onPrivateSubscribe:null,disableWithCredentials:!1},n._configure(t),n}return e=r,(t=[{key:"setToken",value:function(e){this._token=e}},{key:"setConnectData",value:function(e){this._connectData=e}},{key:"setRefreshHeaders",value:function(e){this._config.refreshHeaders=e}},{key:"setRefreshParams",value:function(e){this._config.refreshParams=e}},{key:"setRefreshData",value:function(e){this._config.refreshData=e}},{key:"setSubscribeHeaders",value:function(e){this._config.subscribeHeaders=e}},{key:"setSubscribeParams",value:function(e){this._config.subscribeParams=e}},{key:"_ajax",value:function(e,t,n,s,r){var i,o,u,c=this,a="";for(o in this._debug("sending AJAX request to",e,"with data",JSON.stringify(s)),i=null!==this._xmlhttprequest?new this._xmlhttprequest:h.g.XMLHttpRequest?new h.g.XMLHttpRequest:new h.g.ActiveXObject("Microsoft.XMLHTTP"),t)t.hasOwnProperty(o)&&(0<a.length&&(a+="&"),a+=encodeURIComponent(o)+"="+encodeURIComponent(t[o]));for(u in 0<a.length&&(a="?"+a),i.open("POST",e+a,!0),"withCredentials"in i&&(i.withCredentials=!this._config.disableWithCredentials),i.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.setRequestHeader("Content-Type","application/json"),n)n.hasOwnProperty(u)&&i.setRequestHeader(u,n[u]);return i.onreadystatechange=function(){if(4===i.readyState)if(200===i.status){var e,t=!1;try{e=JSON.parse(i.responseText),t=!0}catch(e){r({error:"Invalid JSON. Data was: "+i.responseText,status:200,data:null})}t&&r({data:e,status:200})}else c._log("wrong status code in AJAX response",i.status),r({status:i.status,data:null})},setTimeout(function(){return i.send(JSON.stringify(s))},20),i}},{key:"_log",value:function(){(0,c.log)("info",arguments)}},{key:"_debug",value:function(){!0===this._config.debug&&(0,c.log)("debug",arguments)}},{key:"_websocketSupported",value:function(){return null!==this._config.websocket||!("function"!=typeof WebSocket&&"object"!==("undefined"==typeof WebSocket?"undefined":a(WebSocket)))}},{key:"_setFormat",value:function(e){if(!this._formatOverride(e)){if("protobuf"===e)throw new Error("not implemented by JSON only Centrifuge client â€“ use client with Protobuf");this._binary=!1,this._methodType=u.JsonMethodType,this._pushType=u.JsonPushType,this._encoder=new u.JsonEncoder,this._decoder=new u.JsonDecoder}}},{key:"_formatOverride",value:function(e){return!1}},{key:"_configure",value:function(e){if(!("Promise"in h.g))throw new Error("Promise polyfill required");if((0,c.extend)(this._config,e||{}),this._debug("centrifuge config",this._config),!this._url)throw new Error("url required");if((0,c.startsWith)(this._url,"ws")&&-1<this._url.indexOf("format=protobuf")?this._setFormat("protobuf"):this._setFormat("json"),(0,c.startsWith)(this._url,"http"))if(this._debug("client will try to connect to SockJS endpoint"),null!==this._config.sockjs)this._debug("SockJS explicitly provided in options"),this._sockjs=this._config.sockjs;else{if(void 0===h.g.SockJS)throw new Error("SockJS not found, use ws:// in url or include SockJS");this._debug("use globally defined SockJS"),this._sockjs=h.g.SockJS}else this._debug("client will connect to websocket endpoint");this._xmlhttprequest=this._config.xmlhttprequest}},{key:"_setStatus",value:function(e){this._status!==e&&(this._debug("Status",this._status,"->",e),this._status=e)}},{key:"_isDisconnected",value:function(){return"disconnected"===this._status}},{key:"_isConnecting",value:function(){return"connecting"===this._status}},{key:"_isConnected",value:function(){return"connected"===this._status}},{key:"_nextMessageId",value:function(){return++this._messageId}},{key:"_resetRetry",value:function(){this._debug("reset retries count to 0"),this._retries=0}},{key:"_getRetryInterval",value:function(){var e=(0,c.backoff)(this._retries,this._config.minRetry,this._config.maxRetry);return this._retries+=1,e}},{key:"_abortInflightXHRs",value:function(){for(var e in this._xhrs){try{this._xhrs[e].abort()}catch(e){this._debug("error aborting xhr",e)}delete this._xhrs[e]}}},{key:"_clearConnectedState",value:function(e){for(var t in this._clientID=null,this._stopPing(),this._callbacks)this._callbacks.hasOwnProperty(t)&&(t=this._callbacks[t],clearTimeout(t.timeout),(t=t.errback)&&t({error:this._createErrorObject("disconnected")}));for(var n in this._callbacks={},this._subs)this._subs.hasOwnProperty(n)&&(n=this._subs[n],e?(n._isSuccess()&&(n._triggerUnsubscribe(),n._recover=!0),n._shouldResubscribe()&&n._setSubscribing()):n._setUnsubscribed());for(var s in this._abortInflightXHRs(),null!==this._refreshTimeout&&(clearTimeout(this._refreshTimeout),this._refreshTimeout=null),this._subRefreshTimeouts)this._subRefreshTimeouts.hasOwnProperty(s)&&this._subRefreshTimeouts[s]&&this._clearSubRefreshTimeout(s);this._subRefreshTimeouts={},this._reconnect||(this._subs={})}},{key:"_isTransportOpen",value:function(){return this._isSockjs?this._transport&&this._transport.transport&&this._transport.transport.readyState===this._transport.transport.OPEN:this._transport&&this._transport.readyState===this._transport.OPEN}},{key:"_transportSend",value:function(e){if(!e.length)return!0;if(this._isTransportOpen())return this._transport.send(this._encoder.encodeCommands(e)),!0;for(var t in e){var n=t.id;n in this._callbacks&&(t=this._callbacks[n],clearTimeout(this._callbacks[n].timeout),delete this._callbacks[n],(0,t.errback)({error:this._createErrorObject(p,0)}))}return!1}},{key:"_setupTransport",value:function(){var i=this;if(this._isSockjs=!1,null!==this._sockjs){var e={transports:this._config.sockjsTransports};null!==this._config.sockjsServer&&(e.server=this._config.sockjsServer),this._isSockjs=!0,this._transport=new this._sockjs(this._url,null,e)}else{if(!this._websocketSupported())return void this._debug("No Websocket support and no SockJS configured, can not connect");null!==this._config.websocket?this._websocket=this._config.websocket:this._websocket=WebSocket,this._transport=new this._websocket(this._url),!0===this._binary&&(this._transport.binaryType="arraybuffer")}this._transport.onopen=function(){i._transportClosed=!1,i._isSockjs?(i._transportName="sockjs-"+i._transport.transport,i._transport.onheartbeat=function(){return i._restartPing()}):i._transportName="websocket";var e={};(i._token||i._connectData||i._config.name||i._config.version)&&(e.params={}),i._token&&(e.params.token=i._token),i._connectData&&(e.params.data=i._connectData),i._config.name&&(e.params.name=i._config.name),i._config.version&&(e.params.version=i._config.version);var t,n,s={},r=!1;for(t in i._serverSubs)i._serverSubs.hasOwnProperty(t)&&i._serverSubs[t].recoverable&&(n={recover:r=!0},i._serverSubs[t].seq||i._serverSubs[t].gen?(i._serverSubs[t].seq&&(n.seq=i._serverSubs[t].seq),i._serverSubs[t].gen&&(n.gen=i._serverSubs[t].gen)):i._serverSubs[t].offset&&(n.offset=i._serverSubs[t].offset),i._serverSubs[t].epoch&&(n.epoch=i._serverSubs[t].epoch),s[t]=n);r&&(e.params||(e.params={}),e.params.subs=s),i._latencyStart=new Date,i._call(e).then(function(e){i._connectResponse(i._decoder.decodeCommandResult(i._methodType.CONNECT,e.result),r),e.next&&e.next()},function(e){109===e.error.code&&(i._refreshRequired=!0),i._disconnect("connect error",!0),e.next&&e.next()})},this._transport.onerror=function(e){i._debug("transport level error",e)},this._transport.onclose=function(t){i._transportClosed=!0;var n=p,e=!0;if(t&&"reason"in t&&t.reason)try{var s=JSON.parse(t.reason);i._debug("reason is an advice object",s),n=s.reason,e=s.reconnect}catch(e){n=t.reason,i._debug("reason is a plain string",n)}null!==i._config.onTransportClose&&i._config.onTransportClose({event:t,reason:n,reconnect:e}),i._disconnect(n,e),!0===i._reconnect&&(i._reconnecting=!0,e=i._getRetryInterval(),i._debug("reconnect after "+e+" milliseconds"),setTimeout(function(){!0===i._reconnect&&(i._refreshRequired?i._refresh():i._connect())},e))},this._transport.onmessage=function(e){i._dataReceived(e.data)}}},{key:"rpc",value:function(e){return this._rpc("",e)}},{key:"namedRPC",value:function(e,t){return this._rpc(e,t)}},{key:"_rpc",value:function(e,t){t={data:t};""!==e&&(t.method=e);t={method:this._methodType.RPC,params:t};return this._methodCall(t,function(e){return e})}},{key:"send",value:function(e){e={method:this._methodType.SEND,params:{data:e}};return this.isConnected()&&this._transportSend([e])?Promise.resolve({}):Promise.reject(this._createErrorObject(p,0))}},{key:"_getHistoryParams",value:function(e,t){e={channel:e};return void 0!==t&&(t.since&&(e.use_since=!0,t.since.offset&&(e.offset=t.since.offset),t.since.epoch&&(e.epoch=t.since.epoch)),void 0!==t.limit&&(e.use_limit=!0,e.limit=t.limit)),e}},{key:"_methodCall",value:function(s,r){var i=this;return this.isConnected()?new Promise(function(t,n){i._call(s).then(function(e){t(r(i._decoder.decodeCommandResult(s.method,e.result))),e.next&&e.next()},function(e){n(e.error),e.next&&e.next()})}):Promise.reject(this._createErrorObject(p,0))}},{key:"publish",value:function(e,t){t={method:this._methodType.PUBLISH,params:{channel:e,data:t}};return this._methodCall(t,function(){return{}})}},{key:"history",value:function(e,t){t=this._getHistoryParams(e,t),t={method:this._methodType.HISTORY,params:t};return this._methodCall(t,function(e){return{publications:e.publications,epoch:e.epoch||"",offset:e.offset||0}})}},{key:"presence",value:function(e){e={method:this._methodType.PRESENCE,params:{channel:e}};return this._methodCall(e,function(e){return{presence:e.presence}})}},{key:"presenceStats",value:function(e){e={method:this._methodType.PRESENCE_STATS,params:{channel:e}};return this._methodCall(e,function(e){return{num_users:e.num_users,num_clients:e.num_clients}})}},{key:"_dataReceived",value:function(e){var n=this,s=this._decoder.decodeReplies(e);this._dispatchPromise=this._dispatchPromise.then(function(){var t;n._dispatchPromise=new Promise(function(e){t=e}),n._dispatchSynchronized(s,t)}),this._restartPing()}},{key:"_dispatchSynchronized",value:function(t,e){var n,s=this,r=Promise.resolve();for(n in t)!function(e){t.hasOwnProperty(e)&&(r=r.then(function(){return s._dispatchReply(t[e])}))}(n);r=r.then(function(){e()})}},{key:"_dispatchReply",value:function(e){var t,n=new Promise(function(e){t=e});if(null==e)return this._debug("dispatch: got undefined or null reply"),t(),n;var s=e.id;return s&&0<s?this._handleReply(e,t):this._handlePush(e.result,t),n}},{key:"_call",value:function(s){var r=this;return new Promise(function(e,t){var n=r._addMessage(s);r._registerCall(n,e,t)})}},{key:"_connect",value:function(){this.isConnected()?this._debug("connect called when already connected"):"connecting"!==this._status&&(this._debug("start connecting"),this._setStatus("connecting"),this._clientID=null,this._reconnect=!0,this._setupTransport())}},{key:"_disconnect",value:function(e,t){var n=t||!1;if(!1===n&&(this._reconnect=!1),this._isDisconnected())n||this._clearConnectedState(n);else{if(this._clearConnectedState(n),this._debug("disconnected:",e,t),this._setStatus("disconnected"),this._refreshTimeout&&(clearTimeout(this._refreshTimeout),this._refreshTimeout=null),!1===this._reconnecting){for(var s in this._serverSubs)this._serverSubs.hasOwnProperty(s)&&this.emit("unsubscribe",{channel:s});this.emit("disconnect",{reason:e,reconnect:n})}!1===n&&(this._subs={},this._serverSubs={}),this._transportClosed||this._transport.close()}}},{key:"_refreshFailed",value:function(){this._numRefreshFailed=0,this._isDisconnected()||this._disconnect("refresh failed",!1),null!==this._config.onRefreshFailed&&this._config.onRefreshFailed()}},{key:"_refresh",value:function(){var n=this;if(this._debug("refresh token"),0===this._config.refreshAttempts)return this._debug("refresh attempts set to 0, do not send refresh request at all"),void this._refreshFailed();null!==this._refreshTimeout&&(clearTimeout(this._refreshTimeout),this._refreshTimeout=null);var s=this._clientID,r=this._newXHRID(),e=function(e){var t;r in n._xhrs&&delete n._xhrs[r],n._clientID===s&&(e.error||200!==e.status?(e.error?n._debug("error refreshing connection token",e.error):n._debug("error refreshing connection token: wrong status code",e.status),n._numRefreshFailed++,null!==n._refreshTimeout&&(clearTimeout(n._refreshTimeout),n._refreshTimeout=null),null!==n._config.refreshAttempts&&n._numRefreshFailed>=n._config.refreshAttempts?n._refreshFailed():(t=Math.round(1e3*Math.random()*Math.max(n._numRefreshFailed,20)),t=n._config.refreshInterval+t,n._refreshTimeout=setTimeout(function(){return n._refresh()},t))):(n._numRefreshFailed=0,n._token=e.data.token,n._token?n._isDisconnected()&&n._reconnect?(n._debug("token refreshed, connect from scratch"),n._connect()):(n._debug("send refreshed token"),e={method:n._methodType.REFRESH,params:{token:n._token}},n._call(e).then(function(e){n._refreshResponse(n._decoder.decodeCommandResult(n._methodType.REFRESH,e.result)),e.next&&e.next()},function(e){n._refreshError(e.error),e.next&&e.next()})):n._refreshFailed()))};null!==this._config.onRefresh?this._config.onRefresh({},e):(e=this._ajax(this._config.refreshEndpoint,this._config.refreshParams,this._config.refreshHeaders,this._config.refreshData,e),this._xhrs[r]=e)}},{key:"_refreshError",value:function(e){var t=this;this._debug("refresh error",e),this._refreshTimeout&&(clearTimeout(this._refreshTimeout),this._refreshTimeout=null);e=this._config.refreshInterval+Math.round(1e3*Math.random());this._refreshTimeout=setTimeout(function(){return t._refresh()},e)}},{key:"_refreshResponse",value:function(e){var t=this;this._refreshTimeout&&(clearTimeout(this._refreshTimeout),this._refreshTimeout=null),e.expires&&(this._clientID=e.client,this._refreshTimeout=setTimeout(function(){return t._refresh()},this._getTTLMilliseconds(e.ttl)))}},{key:"_newXHRID",value:function(){return this._xhrID++,this._xhrID}},{key:"_subRefresh",value:function(r){var i,o,e,t,u=this;this._debug("refresh subscription token for channel",r),void 0!==this._subRefreshTimeouts[r]&&(this._clearSubRefreshTimeout(r),i=this._clientID,o=this._newXHRID(),t=function(e){if(o in u._xhrs&&delete u._xhrs[o],!e.error&&200===e.status&&u._clientID===i){var t={};if(e.data.channels)for(var n in e.data.channels){n=e.data.channels[n];n.channel&&(t[n.channel]=n.token)}var s=t[r];s&&(s={method:u._methodType.SUB_REFRESH,params:{channel:r,token:s}},null!==u._getSub(r)&&u._call(s).then(function(e){u._subRefreshResponse(r,u._decoder.decodeCommandResult(u._methodType.SUB_REFRESH,e.result)),e.next&&e.next()},function(e){u._subRefreshError(r,e.error),e.next&&e.next()}))}},e={client:this._clientID,channels:[r]},null!==this._config.onPrivateSubscribe?this._config.onPrivateSubscribe({data:e},t):(t=this._ajax(this._config.subscribeEndpoint,this._config.subscribeParams,this._config.subscribeHeaders,e,t),this._xhrs[o]=t))}},{key:"_clearSubRefreshTimeout",value:function(e){void 0!==this._subRefreshTimeouts[e]&&(clearTimeout(this._subRefreshTimeouts[e]),delete this._subRefreshTimeouts[e])}},{key:"_subRefreshError",value:function(e,t){var n=this;this._debug("subscription refresh error",e,t),this._clearSubRefreshTimeout(e),null!==this._getSub(e)&&(t=Math.round(1e3*Math.random()),t=setTimeout(function(){return n._subRefresh(e)},this._config.subRefreshInterval+t),this._subRefreshTimeouts[e]=t)}},{key:"_subRefreshResponse",value:function(e,t){var n=this;this._debug("subscription refresh success",e),this._clearSubRefreshTimeout(e),null!==this._getSub(e)&&!0===t.expires&&(t=setTimeout(function(){return n._subRefresh(e)},this._getTTLMilliseconds(t.ttl)),this._subRefreshTimeouts[e]=t)}},{key:"_subscribe",value:function(e,t){var n=this;this._debug("subscribing on",e.channel);var s,r,i,o,u=e.channel;u in this._subs||(this._subs[u]=e),this.isConnected()?(e._setSubscribing(t),s={method:this._methodType.SUBSCRIBE,params:{channel:u}},(0,c.startsWith)(u,this._config.privateChannelPrefix)?this._isSubscribeBatching?this._privateChannels[u]=!0:(this.startSubscribeBatching(),this._subscribe(e),this.stopSubscribeBatching()):(!0===(r=e._needRecover())&&(s.params.recover=!0,i=this._getLastSeq(u),t=this._getLastGen(u),i||t?(i&&(s.params.seq=i),t&&(s.params.gen=t)):(o=this._getLastOffset(u))&&(s.params.offset=o),(o=this._getLastEpoch(u))&&(s.params.epoch=o)),this._call(s).then(function(e){n._subscribeResponse(u,r,n._decoder.decodeCommandResult(n._methodType.SUBSCRIBE,e.result)),e.next&&e.next()},function(e){n._subscribeError(u,e.error),e.next&&e.next()}))):e._setNew()}},{key:"_unsubscribe",value:function(e){delete this._subs[e.channel],delete this._lastOffset[e.channel],delete this._lastSeq[e.channel],delete this._lastGen[e.channel],this.isConnected()&&this._addMessage({method:this._methodType.UNSUBSCRIBE,params:{channel:e.channel}})}},{key:"_getTTLMilliseconds",value:function(e){return Math.min(1e3*e,2147483647)}},{key:"getSub",value:function(e){return this._getSub(e)}},{key:"_getSub",value:function(e){e=this._subs[e];return e||null}},{key:"_isServerSub",value:function(e){return void 0!==this._serverSubs[e]}},{key:"_connectResponse",value:function(e,t){var n=this,s=this._reconnecting;if(this._reconnecting=!1,this._resetRetry(),this._refreshRequired=!1,!this.isConnected()){for(var r in null!==this._latencyStart&&(this._latency=(new Date).getTime()-this._latencyStart.getTime(),this._latencyStart=null),this._clientID=e.client,this._setStatus("connected"),this._refreshTimeout&&clearTimeout(this._refreshTimeout),e.expires&&(this._refreshTimeout=setTimeout(function(){return n._refresh()},this._getTTLMilliseconds(e.ttl))),this.startBatching(),this.startSubscribeBatching(),this._subs)!this._subs.hasOwnProperty(r)||(r=this._subs[r])._shouldResubscribe()&&this._subscribe(r,s);this.stopSubscribeBatching(),this.stopBatching(),this._startPing();var i={client:e.client,transport:this._transportName,latency:this._latency};e.data&&(i.data=e.data),this.emit("connect",i),e.subs&&this._processServerSubs(e.subs)}}},{key:"_processServerSubs",value:function(e){for(var t in e){var n,s;e.hasOwnProperty(t)&&(n=e[t],s=void 0!==this._serverSubs[t],s=this._expandSubscribeContext(s={channel:t,isResubscribe:s},n),this.emit("subscribe",s))}for(var r in e)if(e.hasOwnProperty(r)){var i=e[r];if(i.recovered){var o=i.publications;if(o&&0<o.length)for(var u in o=1<o.length&&(!o[0].offset||o[0].offset>o[1].offset)?o.reverse():o)o.hasOwnProperty(u)&&this._handlePublication(r,o[u])}this._serverSubs[r]={seq:i.seq,gen:i.gen,offset:i.offset,epoch:i.epoch,recoverable:i.recoverable}}}},{key:"_stopPing",value:function(){null!==this._pongTimeout&&(clearTimeout(this._pongTimeout),this._pongTimeout=null),null!==this._pingTimeout&&(clearTimeout(this._pingTimeout),this._pingTimeout=null)}},{key:"_startPing",value:function(){var e=this;!0!==this._config.ping||this._config.pingInterval<=0||this.isConnected()&&(this._pingTimeout=setTimeout(function(){e.isConnected()?(e.ping(),e._pongTimeout=setTimeout(function(){e._disconnect("no ping",!0)},e._config.pongWaitTimeout)):e._stopPing()},this._config.pingInterval))}},{key:"_restartPing",value:function(){this._stopPing(),this._startPing()}},{key:"_subscribeError",value:function(e,t){e=this._getSub(e);e&&e._isSubscribing()&&(0!==t.code||t.message!==d?e._setSubscribeError(t):this._disconnect("timeout",!0))}},{key:"_expandSubscribeContext",value:function(e,t){var n=!1;"recovered"in t&&(n=t.recovered),e.recovered=n;var s=!1;"positioned"in t&&(s=t.positioned);var r="";"epoch"in t&&(r=t.epoch);n=0;return"offset"in t&&(n=t.offset),s&&(e.streamPosition={offset:n,epoch:r}),t.data&&(e.data=t.data),e}},{key:"_subscribeResponse",value:function(e,t,n){var s=this,r=this._getSub(e);if(r&&r._isSubscribing()){r._setSubscribeSuccess(n);var i=n.publications;if(i&&0<i.length)for(var o in i=2<=i.length&&!i[0].offset&&!i[1].offset?i.reverse():i)i.hasOwnProperty(o)&&this._handlePublication(e,i[o]);!n.recoverable||t&&n.recovered||(this._lastSeq[e]=n.seq||0,this._lastGen[e]=n.gen||0,this._lastOffset[e]=n.offset||0),this._lastEpoch[e]=n.epoch||"",n.recoverable&&(r._recoverable=!0),!0===n.expires&&(n=setTimeout(function(){return s._subRefresh(e)},this._getTTLMilliseconds(n.ttl)),this._subRefreshTimeouts[e]=n)}}},{key:"_handleReply",value:function(e,t){var n,s=e.id,r=e.result;s in this._callbacks?(n=this._callbacks[s],clearTimeout(this._callbacks[s].timeout),delete this._callbacks[s],(0,c.errorExists)(e)?(s=n.errback)?s({error:e.error,next:t}):t():(n=n.callback)&&n({result:r,next:t})):t()}},{key:"_handleJoin",value:function(e,t){var n={info:t.info},t=this._getSub(e);t?t.emit("join",n):this._isServerSub(e)&&(n.channel=e,this.emit("join",n))}},{key:"_handleLeave",value:function(e,t){var n={info:t.info},t=this._getSub(e);t?t.emit("leave",n):this._isServerSub(e)&&(n.channel=e,this.emit("leave",n))}},{key:"_handleUnsub",value:function(e,t){var n={},s=this._getSub(e);s?(s.unsubscribe(),!0===t.resubscribe&&s.subscribe()):this._isServerSub(e)&&(delete this._serverSubs[e],n.channel=e,this.emit("unsubscribe",n))}},{key:"_handleSub",value:function(e,t){this._serverSubs[e]={seq:t.seq,gen:t.gen,offset:t.offset,epoch:t.epoch,recoverable:t.recoverable};e=this._expandSubscribeContext(e={channel:e,isResubscribe:!1},t);this.emit("subscribe",e)}},{key:"_handlePublication",value:function(e,t){var n=this._getSub(e),s={data:t.data,seq:t.seq,gen:t.gen,offset:t.offset};t.info&&(s.info=t.info),n?(void 0!==t.seq&&(this._lastSeq[e]=t.seq),void 0!==t.gen&&(this._lastGen[e]=t.gen),void 0!==t.offset&&(this._lastOffset[e]=t.offset),n.emit("publish",s)):this._isServerSub(e)&&(void 0!==t.seq&&(this._serverSubs[e].seq=t.seq),void 0!==t.gen&&(this._serverSubs[e].gen=t.gen),void 0!==t.offset&&(this._serverSubs[e].offset=t.offset),s.channel=e,this.emit("publish",s))}},{key:"_handleMessage",value:function(e){this.emit("message",e.data)}},{key:"_handlePush",value:function(e,t){var n=this._decoder.decodePush(e),s=0;"type"in n&&(s=n.type);var r,i,o=n.channel;s===this._pushType.PUBLICATION?(e=this._decoder.decodePushData(this._pushType.PUBLICATION,n.data),this._handlePublication(o,e)):s===this._pushType.MESSAGE?(r=this._decoder.decodePushData(this._pushType.MESSAGE,n.data),this._handleMessage(r)):s===this._pushType.JOIN?(r=this._decoder.decodePushData(this._pushType.JOIN,n.data),this._handleJoin(o,r)):s===this._pushType.LEAVE?(i=this._decoder.decodePushData(this._pushType.LEAVE,n.data),this._handleLeave(o,i)):s===this._pushType.UNSUB?(i=this._decoder.decodePushData(this._pushType.UNSUB,n.data),this._handleUnsub(o,i)):s===this._pushType.SUB&&(n=this._decoder.decodePushData(this._pushType.SUB,n.data),this._handleSub(o,n)),t()}},{key:"_flush",value:function(){var e=this._messages.slice(0);this._messages=[],this._transportSend(e)}},{key:"_ping",value:function(){var t=this,e={method:this._methodType.PING};this._call(e).then(function(e){t._pingResponse(t._decoder.decodeCommandResult(t._methodType.PING,e.result)),e.next&&e.next()},function(e){t._debug("ping error",e.error),e.next&&e.next()})}},{key:"_pingResponse",value:function(e){this.isConnected()&&(this._stopPing(),this._startPing())}},{key:"_getLastSeq",value:function(e){e=this._lastSeq[e];return e||0}},{key:"_getLastOffset",value:function(e){e=this._lastOffset[e];return e||0}},{key:"_getLastGen",value:function(e){e=this._lastGen[e];return e||0}},{key:"_getLastEpoch",value:function(e){e=this._lastEpoch[e];return e||""}},{key:"_createErrorObject",value:function(e,t){return{message:e,code:t||0}}},{key:"_registerCall",value:function(e,t,n){var s=this;this._callbacks[e]={callback:t,errback:n,timeout:null},this._callbacks[e].timeout=setTimeout(function(){delete s._callbacks[e],(0,c.isFunction)(n)&&n({error:s._createErrorObject(d)})},this._config.timeout)}},{key:"_addMessage",value:function(e){var t=this._nextMessageId();return e.id=t,!0===this._isBatching?this._messages.push(e):this._transportSend([e]),t}},{key:"isConnected",value:function(){return this._isConnected()}},{key:"connect",value:function(){this._connect()}},{key:"disconnect",value:function(){this._disconnect("client",!1)}},{key:"ping",value:function(){return this._ping()}},{key:"startBatching",value:function(){this._isBatching=!0}},{key:"stopBatching",value:function(){this._isBatching=!1,this._flush()}},{key:"startSubscribeBatching",value:function(){this._isSubscribeBatching=!0}},{key:"stopSubscribeBatching",value:function(){var c=this;this._isSubscribeBatching=!1;var e=this._privateChannels;this._privateChannels={};var t,n,r,i,s,a=[];for(t in e)e.hasOwnProperty(t)&&this._getSub(t)&&a.push(t);0!==a.length?(n={client:this._clientID,channels:a},r=this._clientID,i=this._newXHRID(),s=function(e){if(i in c._xhrs&&delete c._xhrs[i],c._clientID===r)if(e.error||200!==e.status)for(var t in c._debug("authorization request failed"),a)a.hasOwnProperty(t)&&(t=a[t],c._subscribeError(t,c._createErrorObject("authorization request failed")));else{var o={};if(e.data.channels)for(var n in e.data.channels){n=e.data.channels[n];n.channel&&(o[n.channel]=n.token)}var u,s=!1;for(u in c._isBatching||(c.startBatching(),s=!0),a)a.hasOwnProperty(u)&&function(){var t=a[u],e=o[t];if(!e)return c._subscribeError(t,c._createErrorObject("permission denied",103));var n={method:c._methodType.SUBSCRIBE,params:{channel:t,token:e}},s=c._getSub(t);if(null===s)return;var r,i=s._needRecover();!0===i&&(n.params.recover=!0,e=c._getLastSeq(t),s=c._getLastGen(t),e||s?(e&&(n.params.seq=e),s&&(n.params.gen=s)):(r=c._getLastOffset(t))&&(n.params.offset=r),(r=c._getLastEpoch(t))&&(n.params.epoch=r)),c._call(n).then(function(e){c._subscribeResponse(t,i,c._decoder.decodeCommandResult(c._methodType.SUBSCRIBE,e.result)),e.next&&e.next()},function(e){c._subscribeError(t,e.error),e.next&&e.next()})}();s&&c.stopBatching()}},null!==this._config.onPrivateSubscribe?this._config.onPrivateSubscribe({data:n},s):(s=this._ajax(this._config.subscribeEndpoint,this._config.subscribeParams,this._config.subscribeHeaders,n,s),this._xhrs[i]=s)):this._debug("no private channels found, no need to make request")}},{key:"subscribe",value:function(e,t){var n=this._getSub(e);if(null!==n)return n._setEvents(t),n._isUnsubscribed()&&n.subscribe(),n;t=new o.default(this,e,t);return(this._subs[e]=t).subscribe(),t}}])&&l(e.prototype,t),n&&l(e,n),r}();t.Centrifuge=s},579:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;n=n(382).Centrifuge;t.default=n,e.exports=t.default},147:function(e,t){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function r(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}Object.defineProperty(t,"__esModule",{value:!0}),t.JsonDecoder=t.JsonEncoder=t.JsonPushType=t.JsonMethodType=void 0;t.JsonMethodType={CONNECT:0,SUBSCRIBE:1,UNSUBSCRIBE:2,PUBLISH:3,PRESENCE:4,PRESENCE_STATS:5,HISTORY:6,PING:7,SEND:8,RPC:9,REFRESH:10,SUB_REFRESH:11};t.JsonPushType={PUBLICATION:0,JOIN:1,LEAVE:2,UNSUB:3,MESSAGE:4,SUB:5},t.JsonEncoder=function(){function e(){n(this,e)}return r(e,[{key:"encodeCommands",value:function(e){return e.map(function(e){return JSON.stringify(e)}).join("\n")}}]),e}(),t.JsonDecoder=function(){function e(){n(this,e)}return r(e,[{key:"decodeReplies",value:function(e){return e.split("\n").filter(function(e){return""!==e}).map(function(e){return JSON.parse(e)})}},{key:"decodeCommandResult",value:function(e,t){return t}},{key:"decodePush",value:function(e){return e}},{key:"decodePushData",value:function(e,t){return t}}]),e}()},471:function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s,o=(s=n(187))&&s.__esModule?s:{default:s},u=n(853);function c(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(n){var s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=i(n);return e=s?(e=i(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),t=this,!(e=e)||"object"!==r(e)&&"function"!=typeof e?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var l=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(i,o["default"]);var e,t,n,r=h(i);function i(e,t,n){var s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(s=r.call(this)).channel=t,s._centrifuge=e,s._status=0,s._error=null,s._isResubscribe=!1,s._ready=!1,s._subscriptionPromise=null,s._noResubscribe=!1,s._recoverable=!1,s._recover=!1,s._setEvents(n),s._initializePromise(),s._promises={},s._promiseId=0,s.on("error",function(e){this._centrifuge._debug("subscription error",e)}),s}return e=i,(t=[{key:"_nextPromiseId",value:function(){return++this._promiseId}},{key:"_initializePromise",value:function(){var s=this;this._ready=!1,this._subscriptionPromise=new Promise(function(t,n){s._resolve=function(e){s._ready=!0,t(e)},s._reject=function(e){s._ready=!0,n(e)}}).then(function(){},function(){})}},{key:"_needRecover",value:function(){return!0===this._recoverable&&!0===this._recover}},{key:"_setEvents",value:function(e){if(e)if((0,u.isFunction)(e))this.on("publish",e);else if(Object.prototype.toString.call(e)===Object.prototype.toString.call({}))for(var t=["publish","join","leave","unsubscribe","subscribe","error"],n=0,s=t.length;n<s;n++){var r=t[n];r in e&&this.on(r,e[r])}}},{key:"_isNew",value:function(){return 0===this._status}},{key:"_isUnsubscribed",value:function(){return 4===this._status}},{key:"_isSubscribing",value:function(){return 1===this._status}},{key:"_isReady",value:function(){return 2===this._status||3===this._status}},{key:"_isSuccess",value:function(){return 2===this._status}},{key:"_isError",value:function(){return 3===this._status}},{key:"_setNew",value:function(){this._status=0}},{key:"_setSubscribing",value:function(e){this._isResubscribe=e||!1,!0===this._ready&&this._initializePromise(),this._status=1}},{key:"_setSubscribeSuccess",value:function(e){if(2!==this._status){this._status=2;var t,e=this._getSubscribeSuccessContext(e);for(t in this._recover=!1,this.emit("subscribe",e),this._resolve(e),this._promises)clearTimeout(this._promises[t].timeout),this._promises[t].resolve(),delete this._promises[t]}}},{key:"_setSubscribeError",value:function(e){if(3!==this._status){this._status=3,this._error=e;var t,n=this._getSubscribeErrorContext();for(t in this.emit("error",n),this._reject(n),this._promises)clearTimeout(this._promises[t].timeout),this._promises[t].reject(e),delete this._promises[t]}}},{key:"_triggerUnsubscribe",value:function(){this.emit("unsubscribe",{channel:this.channel})}},{key:"_setUnsubscribed",value:function(e){var t;this._centrifuge._clearSubRefreshTimeout(this.channel),4!==this._status&&(t=2===this._status,this._status=4,!0===e&&(this._recover=!1,this._noResubscribe=!0,delete this._centrifuge._lastSeq[this.channel],delete this._centrifuge._lastGen[this.channel],delete this._centrifuge._lastEpoch[this.channel]),t&&this._triggerUnsubscribe())}},{key:"_shouldResubscribe",value:function(){return!this._noResubscribe}},{key:"_getSubscribeSuccessContext",value:function(e){var t={channel:this.channel,isResubscribe:this._isResubscribe};return t=e?this._centrifuge._expandSubscribeContext(t,e):t}},{key:"_getSubscribeErrorContext",value:function(){var e=this._error;return e.channel=this.channel,e.isResubscribe=this._isResubscribe,e}},{key:"ready",value:function(e,t){this._ready&&(this._isSuccess()?e(this._getSubscribeSuccessContext()):t(this._getSubscribeErrorContext()))}},{key:"subscribe",value:function(){2!==this._status&&(this._noResubscribe=!1,this._centrifuge._subscribe(this))}},{key:"unsubscribe",value:function(){this._setUnsubscribed(!0),this._centrifuge._unsubscribe(this)}},{key:"_methodCall",value:function(){var s=this;return this._isSuccess()?Promise.resolve():this._isError()?Promise.reject(this._error):new Promise(function(e,t){var n=setTimeout(function(){t({code:0,message:"timeout"})},s._centrifuge._config.timeout);s._promises[s._nextPromiseId()]={timeout:n,resolve:e,reject:t}})}},{key:"publish",value:function(e){var t=this;return this._methodCall().then(function(){return t._centrifuge.publish(t.channel,e)})}},{key:"presence",value:function(){var e=this;return this._methodCall().then(function(){return e._centrifuge.presence(e.channel)})}},{key:"presenceStats",value:function(){var e=this;return this._methodCall().then(function(){return e._centrifuge.presenceStats(e.channel)})}},{key:"history",value:function(e){var t=this;return this._methodCall().then(function(){return t._centrifuge.history(t.channel,e)})}}])&&c(e.prototype,t),n&&c(e,n),i}();t.default=l,e.exports=t.default},853:function(e,t,n){function s(e){return null!=e&&"function"==typeof e}Object.defineProperty(t,"__esModule",{value:!0}),t.startsWith=function(e,t){return 0===e.lastIndexOf(t,0)},t.isFunction=s,t.log=function(e,t){!n.g.console||s(e=n.g.console[e])&&e.apply(n.g.console,t)},t.backoff=function(e,t,n){var s=.5*Math.random(),e=Math.min(n,t*Math.pow(2,e+1));return Math.floor((1-s)*e)},t.errorExists=function(e){return"error"in e&&null!==e.error},t.extend=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}},187:function(e){var t="object"==typeof Reflect?Reflect:null,c=t&&"function"==typeof t.apply?t.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};var n=t&&"function"==typeof t.ownKeys?t.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)},s=Number.isNaN||function(e){return e!=e};function r(){r.init.call(this)}e.exports=r,e.exports.once=function(r,i){return new Promise(function(e,t){function n(){void 0!==s&&r.removeListener("error",s),e([].slice.call(arguments))}var s;"error"!==i&&(s=function(e){r.removeListener(i,n),t(e)},r.once("error",s)),r.once(i,n)})},(r.EventEmitter=r).prototype._events=void 0,r.prototype._eventsCount=0,r.prototype._maxListeners=void 0;var i=10;function u(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function o(e){return void 0===e._maxListeners?r.defaultMaxListeners:e._maxListeners}function a(e,t,n,s){var r,i;return u(n),void 0===(r=e._events)?(r=e._events=Object.create(null),e._eventsCount=0):(void 0!==r.newListener&&(e.emit("newListener",t,n.listener||n),r=e._events),i=r[t]),void 0===i?(i=r[t]=n,++e._eventsCount):("function"==typeof i?i=r[t]=s?[n,i]:[i,n]:s?i.unshift(n):i.push(n),0<(n=o(e))&&i.length>n&&!i.warned&&(i.warned=!0,(n=new Error("Possible EventEmitter memory leak detected. "+i.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit")).name="MaxListenersExceededWarning",n.emitter=e,n.type=t,n.count=i.length,n=n,console&&console.warn&&console.warn(n))),e}function h(e,t,n){e={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},t=function(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}.bind(e);return t.listener=n,e.wrapFn=t}function l(e,t,n){e=e._events;if(void 0===e)return[];t=e[t];return void 0===t?[]:"function"==typeof t?n?[t.listener||t]:[t]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(t):_(t,t.length)}function f(e){var t=this._events;if(void 0!==t){e=t[e];if("function"==typeof e)return 1;if(void 0!==e)return e.length}return 0}function _(e,t){for(var n=new Array(t),s=0;s<t;++s)n[s]=e[s];return n}Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return i},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");i=e}}),r.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},r.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},r.prototype.getMaxListeners=function(){return o(this)},r.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var s,r="error"===e,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){if((s=0<t.length?t[0]:s)instanceof Error)throw s;r=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw r.context=s,r}e=i[e];if(void 0===e)return!1;if("function"==typeof e)c(e,this,t);else for(var o=e.length,u=_(e,o),n=0;n<o;++n)c(u[n],this,t);return!0},r.prototype.on=r.prototype.addListener=function(e,t){return a(this,e,t,!1)},r.prototype.prependListener=function(e,t){return a(this,e,t,!0)},r.prototype.once=function(e,t){return u(t),this.on(e,h(this,e,t)),this},r.prototype.prependOnceListener=function(e,t){return u(t),this.prependListener(e,h(this,e,t)),this},r.prototype.removeListener=function(e,t){var n,s,r,i,o;if(u(t),void 0===(s=this._events))return this;if(void 0===(n=s[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete s[e],s.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(r=-1,i=n.length-1;0<=i;i--)if(n[i]===t||n[i].listener===t){o=n[i].listener,r=i;break}if(r<0)return this;0===r?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,r),1===n.length&&(s[e]=n[0]),void 0!==s.removeListener&&this.emit("removeListener",e,o||t)}return this},r.prototype.off=r.prototype.removeListener,r.prototype.removeAllListeners=function(e){var t,n=this._events;if(void 0===n)return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){for(var s,r=Object.keys(n),i=0;i<r.length;++i)"removeListener"!==(s=r[i])&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;0<=i;i--)this.removeListener(e,t[i]);return this},r.prototype.listeners=function(e){return l(this,e,!0)},r.prototype.rawListeners=function(e){return l(this,e,!1)},r.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):f.call(e,t)},r.prototype.listenerCount=f,r.prototype.eventNames=function(){return 0<this._eventsCount?n(this._events):[]}}},s={};function r(e){if(s[e])return s[e].exports;var t=s[e]={exports:{}};return n[e](t,t.exports,r),t.exports}return r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r(579)});