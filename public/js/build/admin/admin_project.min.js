$(function(){obj={select_project:function(e){var t=$(e),a=$("#active_project_id"),e=$(e).attr("data-projectid");0<a.val()?$(".mproj-item").removeClass("templates-active"):($(".temp-setlist-no").hide(),$(".admin-temp-rheader").show()),a.val(e),t.parent().addClass("templates-active"),o(e)},project_save:function(){var t,e=Strack.validate_form("modify_project");200===e.status&&(t=$("#active_project_id").val(),e.data.id=t,$.ajax({type:"POST",url:ProjectPHP.modifyProject,data:e.data,dataType:"json",beforeSend:function(){$.messager.progress({title:StrackLang.Waiting,msg:StrackLang.loading})},success:function(e){$.messager.progress("close"),200===parseInt(e.status)?(Strack.top_message({bg:"g",msg:e.message}),i(a),o(t)):layer.msg(e.message,{icon:7,time:1200,anim:6})}}))},project_delete:function(){$.messager.confirm(StrackLang.Delete_Project_Title,StrackLang.Delete_Project_Confirm,function(e){e&&(e=$("#active_project_id").val(),$.ajax({type:"POST",url:ProjectPHP.deleteProject,dataType:"json",data:{primary_ids:e},beforeSend:function(){$.messager.progress({title:StrackLang.Waiting,msg:StrackLang.loading})},success:function(e){$.messager.progress("close"),200===parseInt(e.status)?(Strack.top_message({bg:"g",msg:e.message}),$("#project_details").hide(),$("#active_project_id").val(""),i(a)):layer.msg(e.message,{icon:7,time:1200,anim:6})}}))})},project_filter:function(e){var t=$("#search_val").val();a=0<t.length?{name:["-lk","%"+t+"%"]}:"",obj.refresh_details(),i(a)},refresh_details:function(){$("#active_project_id").val(0),$(".temp-setlist-no").show(),$(".admin-temp-rheader").hide(),$("#project_details").hide()}};var a="";function i(e){$.ajax({type:"POST",url:ProjectPHP.getAdminProjectList,dataType:"json",data:JSON.stringify({filter:e}),contentType:"application/json",beforeSend:function(){$("#project_list").empty().append(Strack.loading_dom("null"))},success:function(e){var a="",t=$("#project_list");e.rows.forEach(function(e){var t;a+=(t="",t+='<div id="mproj_item_'+(e=e).id+'" class="item mproj-item"><a href="javascript:;" class="header" onclick="obj.select_project(this);" data-projectid="'+e.id+'">'+Strack.build_thumb_dom(e.thumb,"icon-uniF1ED")+'<div class="mproj-content text-ellipsis">'+e.name+"</div></a></div>")}),a?($("#pactive_notice").remove(),t.append(a),0<(e=$("#active_project_id").val())&&((e=$("#mproj_item_"+e)).addClass("templates-active"),$(".admin-temp-list").scrollTop(e.offset().top))):0===$("#pactive_notice").length&&t.before('<div id="pactive_notice" class="datagrid-empty-no">'+StrackLang.No_Filter_Project+"</div>"),$("#st-load").remove()}})}function o(a){$.ajax({type:"POST",url:ProjectPHP.getProjectDetails,dataType:"json",data:{project_id:a,module_id:20},beforeSend:function(){$(".admin-temp-right").prepend(Strack.loading_dom("white"))},success:function(e){var t=e.media_data;t.link_id=a,t.module_id=20,t.param.icon="icon-uniE61A",Strack.thumb_media_widget("#project_thumb",t,{modify_thumb:"yes",clear_thumb:"yes"}),$("#project_name").val(e.name),$("#project_code").val(e.code),$("#project_rate").val(e.rate),$("#project_description").val(e.description),Strack.combobox_widget("#project_status",{url:StrackPHP.getProjectStatusCombobox,valueField:"id",textField:"name",width:494,height:39,value:e.status_id,queryParams:{template_id:e.template_id}}),Strack.open_date_box("#project_start",494,39,e.start_time),Strack.open_date_box("#project_end",494,39,e.end_time),$("#project_details").show(),$("#st-load").remove()}})}i(a),Strack.listen_keyboard_event(function(e,t){"enter"===t.code&&$("#search_val").is(":focus")&&(e.preventDefault(),obj.project_filter(Strack.get_obj_by_id("search_project_bnt")))})});