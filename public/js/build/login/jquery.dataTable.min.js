var CheckData={},GetJSONData={};!function(d){var DebugMsg=!1,TableSet={};function titltImg(Table){Table.find(".img").css({width:"40px",height:"40px",margin:"0 0 -5px 0"}),Table.find(".showImgBox").css({position:"absolute","z-index":1e3,display:"none",padding:"10px",background:"#FFFFFF","border-radius":"3px","box-shadow":"rgba(153, 153, 153, 0.3) 0px 0px 0px 1px"}),Table.find(".showImg").css({"max-width":"300px"});var showImg=Table.find(".img");showImg.hover(function(){var imgBox=$(this).next(),marginTop=0,marginLeft=40,tableHeight=Table.height(),tableWidth=Table.width(),imgBoxHeight=imgBox.height(),imgBoxWidth=imgBox.width(),trTop=$(this).parent().parent().position().top,tdLeft=$(this).parent().position().left;tableHeight-trTop-imgBoxHeight<35&&(marginTop=-eval(imgBoxHeight+60)),tableWidth-tdLeft-imgBoxWidth<0&&(marginLeft=-eval(imgBoxWidth+20)),imgBox.css({margin:marginTop+"px 0 0 "+marginLeft+"px",display:"block"})},function(){$(this).next().css({display:"none"})})}function empty(e){return void 0===e}function status(e,t){var a="";404==t.status?a=",出现此情况一般为URL不正确未请求到后台":500==t.status&&(a=",出现此情况一般为后台程序发生错误"),debug(e+"后台信息,状态码:"+t.status+",描述:"+t.statusText+a)}function DifferentStyle(e,t){var a=!0,t=t.oddEven;if(a=!empty(t)?t:a)for(var l=e.find("tr"),n=0;n<l.length;n++)l.eq(n+1).attr("data-row")%2==0&&l.eq(n+1).css({"background-color":"#f2f2f2"})}function GetClickRowData(e,t,a){var l=0;if(0==t&&(l=GerRowData(e.parentNode)),0==(l=2==t?GerRowData(e):l))return null;a=GetJSONData[a][l-2];return a.LineNumber=l,a}function Animation(TableID,o){var table,top,width,height,startAnimation,TableLoading,style,loading,dt_animation,startAnimation;(empty(TableSet[TableID].Object.loading)||TableSet[TableID].Object.loading)&&(table=$("#"+TableID),top=table.height()/2,width=table.width(),height=table.height(),startAnimation=null,TableLoading=$("#"+TableID+"_loading"),"start"==o&&(0<TableLoading.length&&TableLoading.remove(),style="#232323",empty(TableSet[TableID].Object.ButtonStyle)||(style=TableSet[TableID].Object.ButtonStyle.backgroundColor),loading='<div id="'+TableID+'_loading" style="position: absolute;left: 0;top:0;color:#232323;background:rgba(250, 250, 250, 0.7);z-index: 500;width: '+width+"px;height: "+height+'px;text-align: center;font-size: 14px;font-family:Helvetica Neue,Helvetica,Arial,PingFang SC,Hiragino Sans GB,WenQuanYi Micro Hei,Microsoft Yahei,sans-serif;"><span style="margin-top: '+top+"px;left:"+eval(50-20/width)+'%;position: absolute;"><span class="dt_animation" style="position:relative;width:20px;height:20px;background:'+style+';">&nbsp;&nbsp;</span></span><span style="margin-top: '+eval(top+20)+"px;left:"+eval(50-20/width)+"%;position: absolute;color: "+style+';">加载中...</span></div>',table.append(loading),dt_animation=$(".dt_animation"),startAnimation=function(){dt_animation.animate({left:10},"slow"),dt_animation.animate({left:30},"slow"),dt_animation.animate({left:10},"slow"),dt_animation.animate({left:0},"slow",startAnimation)},startAnimation()),"stop"==o&&(startAnimation=null,TableLoading.remove()))}function ClearTable(e){e.html("")}function UpdateData(Object,Table,TableID,page){var columns=Object.columns,pageCapacity=Object.pageCapacity;$.ajax({type:Object.method,url:Object.url,data:{page:page,pageCapacity:pageCapacity},dataType:"json",beforeSend:function(){Animation(TableID,"start")},success:function(json){if(Animation(TableID,"stop"),null!=json){var total=json.total;if(json=json.rows,null!=json){var jsonCount=json.length;GetJSONData[TableID]=json;for(var r=0;r<jsonCount;r++)for(var c=0;c<columns.length;c++){var ColumnContent=json[r][columns[c].ColumnName],table_td=Table.find("tr").eq(r+1).find("."+TableID+"_td").eq(c),td_serial;empty(Object.serial)||Object.serial&&(td_serial=Table.find("tr").eq(r+1).find("."+TableID+"_td_serial").eq(c),1==page?(td_serial.html(r+1),td_serial.attr("title","序号 "+eval(r+1))):(td_serial.html(pageCapacity*(page-1)+eval(r+1)),td_serial.attr("title","序号 "+eval(pageCapacity*(page-1)+eval(r+1))))),0<table_td.find("img").length?(table_td.html("<img src='"+ColumnContent+"' class='img'><span class='showImgBox'><img src='"+ColumnContent+"' class='showImg'></span>"),titltImg(Table)):(table_td.html(ColumnContent),table_td.attr("title",ColumnContent))}var totalPage=Math.ceil(total/pageCapacity);if($("."+TableID+"_page_tip").html("当前在第"+page+"页,总页"+totalPage+"页"),jsonCount<pageCapacity)for(var poor=pageCapacity-jsonCount,i=1;i<=poor;i++)Table.find("tr").eq(jsonCount+i).hide();else Table.find("tr").show();Table.find("tr").find("td").css({border:"1px solid #d8d8d8",padding:"5px"})}else debug(TableID+"返回数据为空,或返回格式不正确")}},error:function(e){Animation(TableID,"stop"),status(TableID,e)}})}function GerRowData(e){e=e.getAttribute("data-row");return null!=e&&""!=e?e:0}function debug(e){var t;DebugMsg&&($("body").append("<div class='DataTableDebugMsg'>DataTable调试信息: <span style='color: #ff5c6f;'>"+e+"!</span><a class='debugOut' href='javascript:void(0);'>(点我隐藏此条信息)</a></div>"),t=$(".DataTableDebugMsg"),e=$(".debugOut"),t.css({position:"fixed","z-index":"9999",margin:"0 auto",left:"0",right:"0",background:"#FCFCFC","font-size":"12px","font-family":'"Microsoft YaHei", "微软雅黑", helvetica, arial, verdana, tahoma, sans-serif',color:"#000000",height:"60px",width:"70%","text-align":"center","line-height":"60px",border:"1px solid #d8d8d8","border-radius":"3px",top:"45%"}),e.css({margin:"0 10px","text-decoration":"none"}),e.click(6e3,function(){$(this).parent().remove()}))}d.fn.dataTable=function(Obj){DebugMsg=!1;var t=d(this);ClearTable(t);try{var tid=t[0].id}catch(Ex){}var page=1;function CreateTable(Object,Table,TableID,page){var method;empty(TableSet[TableID])&&(TableSet[TableID]={Object:Object,Table:Table}),TableSet[TableID].Object.url=Object.url,empty(Object.method)?TableSet[TableID].Object.method="GET":(method=Object.method.toUpperCase(),TableSet[TableID].Object.method=method),empty(Object.serial)?TableSet[TableID].Object.serial=!0:TableSet[TableID].Object.serial=Object.serial;var pageCapacity=10;empty(Object.pageCapacity)?empty(TableSet[TableID].Object.pageCapacity)&&(TableSet[TableID].Object.pageCapacity=pageCapacity):TableSet[TableID].Object.pageCapacity=Object.pageCapacity,Object=TableSet[TableID].Object,Table=TableSet[TableID].Table,pageCapacity=TableSet[TableID].Object.pageCapacity,empty(Object.debug)||(DebugMsg=Object.debug);var columns=Object.columns;if(empty(columns))debug(TableID+"未绑定columns");else if(empty(Table[0]))debug("未找到指定的table,检查table是否存在");else{Table.append("<tr class='"+TableID+"_dt_head'></tr>");for(var h=0;h<columns.length;h++){var w=Object.columns[h].width,width="auto";empty(w)||(width=w+"px"),Table.find("tr").eq(0).append("<td class='"+TableID+"_td_head' style='width:"+width+";'>"+columns[h].title+"</td>")}empty(Object.serial)||Object.serial&&Table.find("tr").eq(0).prepend("<td class='"+TableID+"_td' title='序号' style='width:25px'>序号</td>"),empty(Object.check)||Object.check&&Table.find("tr").eq(0).prepend("<td class='"+TableID+"_td' title='全选' style='width:25px'><input class='"+TableID+"_dt_check_all' type='checkbox'></td>"),TableStyle();var url=Object.url;if(empty(url))return debug(TableID+"未绑定url"),void TableStyle();$.ajax({type:Object.method,url:url,data:{page:page,pageCapacity:pageCapacity},dataType:"json",beforeSend:function(){Animation(TableID,"start")},success:function(e){Animation(TableID,"stop");var t=e.total;null!=(e=e.rows)?dataCreateTable(TableID,t,e,Table,columns,Object):debug(TableID+"返回数据为空,或返回格式不正确")},error:function(e){Animation(TableID,"stop"),status(TableID,e)}})}function TableStyle(){Table.css({"border-collapse":"collapse","font-family":'"Microsoft YaHei", "微软雅黑", helvetica, arial, verdana, tahoma, sans-serif',"font-size":"14px","table-layout":"fixed",position:"absolute",left:" 0",top:"0"}),Table.find("td").css({border:"1px solid #d8d8d8",padding:"5px",overflow:"hidden","white-space":"nowrap",cursor:"pointer","text-align":"left"}),Table.find("tr").eq(0).find("td").css({cursor:"auto"}),Table.find("tr").eq(0).find("td").eq(0).css({cursor:"pointer"}),titltImg(Table),Table.find("."+TableID+"_dt_checkbox,."+TableID+"_dt_check_all").css({width:"15px",height:"15px",margin:"0 auto",display:"block"}),Table.find(".Button").css({padding:"2px 10px",overflow:"hidden","white-space":"nowrap","text-align":"center","line-height":"100%","border-radius":"3px",background:" #232323","-moz-user-select":"none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none",color:"#ffffff","z-index":"100",cursor:"pointer"});var e=Object.ButtonStyle;empty(e)||Table.find(".Button").css({background:e.backgroundColor,color:e.fontColor}),DifferentStyle(Table,Object),Table.find("tr").hover(function(){this.className!=TableID+"_dt_head"&&(this.style.backgroundColor="#d8d8d8")},function(){this.style.backgroundColor="rgba(216, 216, 216, 0)",DifferentStyle(Table,Object)});e=Object.style;empty(e)||Table.css(e);e=Object.align;empty(e)||(Table.find("."+TableID+"_td").css("text-align",e),Table.find("."+TableID+"_td_head").css("text-align",e))}function dataCreateTable(TableID,total,json,Table,columns,Object){GetJSONData[TableID]=json;for(var r=0,totalPage,pager;r<json.length;r++){Table.append("<tr data-row='"+parseInt(r+2)+"'></tr>");for(var c=0;c<columns.length;c++){var ColumnContent=json[r][columns[c].ColumnName],ColumnTitle=ColumnContent,facility=Object.columns[c].button;if(!empty(facility)){if(""==facility)return void debug(TableID+"未定义按钮");var buttonName=Object.columns[c].buttonName;if(empty(buttonName)||""==buttonName)return void debug(TableID+"自定义按钮未设置按钮名");ColumnContent="<span data-button='"+facility+"' class='"+TableID+"_button_"+facility+" Button'>"+buttonName+"</span>",ColumnTitle=buttonName}var img=Object.columns[c].img;!empty(img)&&img?Table.find("tr").eq(r+1).append("<td class='"+TableID+"_td' data-row='"+parseInt(r+2)+"'><img src='"+ColumnContent+"' class='img'><span class='showImgBox'><img src='"+ColumnContent+"' class='showImg'></span></td>"):Table.find("tr").eq(r+1).append("<td class='"+TableID+"_td' data-row='"+parseInt(r+2)+"' title='"+ColumnTitle+"'>"+ColumnContent+"</td>")}empty(Object.serial)||Object.serial&&Table.find("tr").eq(r+1).prepend("<td class='"+TableID+"_td_serial' data-row='"+parseInt(r+2)+"' title='序号 "+eval(r+1)+"'>"+eval(r+1)+"</td>"),empty(Object.check)||Object.check&&Table.find("tr").eq(r+1).prepend("<td class='"+TableID+"_td_checkbox'><input class='"+TableID+"_dt_checkbox' type='checkbox'></td>")}0<json.length&&0<pageCapacity&&(totalPage=Math.ceil(total/pageCapacity),pager="<div class='tablePager' style='width: 100%;position: absolute;height: 35px;'><span style='float: left;margin: 10px;'>显示条数:</span><select class='Button "+TableID+"_select'><option>10</option><option>20</option><option>30</option><option>40</option><option>50</option></select><span class='Button "+TableID+"_firstPage' title='跳到第一页'>首页</span><span class='Button "+TableID+"_aPage' title='上一页'>上一页</span><span class='Button "+TableID+"_nextPage' title='下一页'>下一页</span><span class='Button "+TableID+"_endPage' title='跳到最后一页'>尾页</span><span class='"+TableID+"_PageInput' style='float: left;'><input class='"+TableID+"_inp' maxlength='5' placeholder='跳页' style='width: 50px;margin: 6px;'></span><span class='Button "+TableID+"_ok' title='跳到目标页'>确定</span></span><span class='Button "+TableID+"_refresh' title='刷新表格数据'>刷新</span><span class='"+TableID+"_page_tip' style='float: left;margin: 10px;'>当前在第"+page+"页,总页"+totalPage+"页</span></div>",Table.append(pager)),TableStyle();var inp=$("."+TableID+"_inp");inp.keydown(function(e){e=parseInt(e.keyCode);return!!(96<=e&&e<=105||48<=e&&e<=57||8==e)}),inp.bind("input propertychange",function(){(isNaN(parseFloat($(this).val()))||parseFloat($(this).val())<=0)&&$(this).val("")}),Table.find(".tablePager").find(".Button").css({float:"left",padding:"5px",margin:"5px"});var CapacitySelect=Table.find(".tablePager").find("."+TableID+"_select");CapacitySelect.css({padding:"1px"}),inp.css({"border-radius":"10px","padding-left":"10px",border:"solid 1px #d8d8d8",outline:"none"});var op=Object.pageCapacity;10!=op&&20!=op&&30!=op&&40!=op&&50!=op&&CapacitySelect.prepend("<option>"+op+"</option>"),CapacitySelect.val(Object.pageCapacity),CapacitySelect.change(function(){Object.pageCapacity=CapacitySelect.val(),ClearTable(Table),CreateTable(Object,Table,TableID,page=1)});var firstPage=Table.find(".tablePager").find("."+TableID+"_firstPage");firstPage.click(function(){return 1!=page&&(pagControl(page=1),ClearChoice(TableID),void UpdateData(Object,Table,TableID,page))});var Refresh=Table.find(".tablePager").find("."+TableID+"_refresh");Refresh.click(function(){pagControl(page),ClearChoice(TableID),UpdateData(Object,Table,TableID,page)});var aPage=Table.find(".tablePager").find("."+TableID+"_aPage");aPage.click(function(){return 1!=page&&(pagControl(--page),void UpdateData(Object,Table,TableID,page))});var nextPage=Table.find(".tablePager").find("."+TableID+"_nextPage");nextPage.click(function(){return page!=totalPage&&(pagControl(++page),ClearChoice(TableID),void UpdateData(Object,Table,TableID,page))});var endPage=Table.find(".tablePager").find("."+TableID+"_endPage");endPage.click(function(){return page!=totalPage&&(pagControl(page=totalPage),ClearChoice(TableID),void UpdateData(Object,Table,TableID,page))});var PageOk=Table.find(".tablePager").find("."+TableID+"_ok");function JumpPage(){var e=inp.val();e<1||totalPage<e||(pagControl(page=e),ClearChoice(TableID),UpdateData(Object,Table,TableID,page))}function pagControl(e){1<e&&(aPage.css({cursor:"pointer"}),firstPage.css({cursor:"pointer"})),1==e&&(aPage.css({cursor:"not-allowed"}),firstPage.css({cursor:"not-allowed"})),e<totalPage&&(nextPage.css({cursor:"pointer"}),endPage.css({cursor:"pointer"})),e==totalPage&&(nextPage.css({cursor:"not-allowed"}),endPage.css({cursor:"not-allowed"}))}PageOk.click(function(){JumpPage()}),inp.keydown(function(e){13==e.keyCode&&JumpPage()});var ClearChoice=function(e){},dt_checkbox,all;pagControl(page),empty(Object.check)||Object.check&&(Table.find("."+TableID+"_td").click(function(e){e.target===this&&this.parentNode.className!=TableID+"_dt_head"&&this.parentNode.firstChild.firstChild.click(),e.target===this&&this.firstChild.className==TableID+"_dt_check_all"&&$("."+TableID+"_dt_check_all").click()}),Table.find("."+TableID+"_td_checkbox").click(function(e){e.target===this&&this.firstChild.click()}),dt_checkbox=$("."+TableID+"_dt_checkbox"),dt_checkbox.click(function(){for(var e,t,a=[],l=0;l<dt_checkbox.length;l++)t=GerRowData(dt_checkbox.eq(l)[0].parentNode.nextSibling),dt_checkbox.eq(l)[0].checked&&(e=GetJSONData[TableID][t-2],a.push(e));a.length<1&&(a=null),CheckData[TableID]=a}),all=0,$("."+TableID+"_dt_check_all").click(function(){all=0==all?(dt_checkbox.click(),dt_checkbox.prop("checked",!0),1):(dt_checkbox.click(),dt_checkbox.prop("checked",!1),0)}),ClearChoice=function(e){var t=$("."+e+"_dt_check_all");t.is(":checked")&&t.click();for(var a=$("."+e+"_dt_checkbox"),l=0;l<a.length;l++)a.eq(l).is(":checked")&&a.eq(l).click()}),Table.find("."+TableID+"_td").find(".Button").click(function(){var e=this.getAttribute("data-button"),t=GetClickRowData(this,0,TableID);try{Object[e+"Click"](this,t)}catch(e){}});var sign=!0;function signEv(e,t,a){e.target===t&&t.parentNode.className!=TableID+"_dt_head"&&(Table.find("tr").find("td").css({border:"1px solid #d8d8d8",padding:"5px"}),t=a.parent().children(":first"),a="#232323",empty(Object.ButtonStyle)||(a=Object.ButtonStyle.backgroundColor),t.css({"border-left":"5px solid "+a,padding:"0 3px 0 0"}))}empty(Object.sign)||(sign=Object.sign),sign&&(Table.find("."+TableID+"_td").click(function(e){signEv(e,this,$(this))}),Table.find("."+TableID+"_td_serial").click(function(e){signEv(e,this,$(this))}));var TimeFn=null;function clickEv(t,a){empty(Object.Click)||(clearTimeout(TimeFn),TimeFn=setTimeout(function(){var e;t.target===a&&a.parentNode.className!=TableID+"_dt_head"&&(e=GetClickRowData(a,2,TableID),Object.Click(e))},300))}function dblclickEv(e,t){empty(Object.doubleClick)||(clearTimeout(TimeFn),e.target===t&&t.parentNode.className!=TableID+"_dt_head"&&(t=GetClickRowData(t,2,TableID),Object.doubleClick(t)))}Table.find("."+TableID+"_td").click(function(e){clickEv(e,this)}),Table.find("."+TableID+"_td_serial").click(function(e){clickEv(e,this)}),Table.find("."+TableID+"_td").dblclick(function(e){dblclickEv(e,this)}),Table.find("."+TableID+"_td_serial").dblclick(function(e){dblclickEv(e,this)})}}CreateTable(Obj,t,tid,page)},d.fn.GetJSONArray=function(){var e=d(this)[0].id;return empty(GetJSONData[e])?null:GetJSONData[e]},d.fn.TableRefresh=function(){var e=d(this)[0].id;$("."+e+"_refresh").click()},d.fn.GetCheckArray=function(){var e=d(this)[0].id;return empty(CheckData[e])?null:CheckData[e]}}(jQuery);