$(function(){obj={show_details_tab_page:function(e){a(e)},refresh_details_tab:function(e){var i=$("#details_tab .tab_item.active").attr("data-tabid"),t={};e.forEach(function(e){t=t||e,e.tab_id===i&&(t=e)}),Strack.generate_tab_list("details_tab",s,e),a(t)},create_single_grid_data:function(e){var i=$(e).data("lang");Strack.item_operate_dialog(i,{mode:"create",field_list_type:["edit"],from_item_id:s.item_id,from_module_id:s.module_id,module_id:m.module_id,project_id:s.project_id,page:m.page,schema_page:m.schema_page,type:"add_panel"},function(){obj.reset_single_grid_data()})},create_horizontal_related:function(e){var i=$(e).data("lang"),t=$(e).closest(".grid-toolbar"),_=$(e),a={project_id:t.data("projectid"),grid_id:t.data("grid"),variable_id:_.attr("variableid"),src_module_id:_.attr("srcmoduleid"),dst_module_id:_.attr("dstmoduleid"),src_link_id:_.attr("srclinkid"),horizontal_type:_.attr("horizontaltype"),link_data:[],from:"toolbar"};Strack.item_operate_dialog(i,{mode:"create_related",field_list_type:["edit"],from_item_id:a.src_link_id,from_module_id:a.src_module_id,module_id:a.dst_module_id,project_id:a.project_id,horizontal_type:a.horizontal_type,variable_id:a.variable_id,page:m.page,schema_page:m.schema_page,type:"add_panel",keep_panel:!0},function(){obj.reset_single_grid_data()})},modify_single_grid_data:function(e){var i=$(e).data("lang");Strack.get_datagrid_select_data("#single_main_datagrid_box",function(e){Strack.item_operate_dialog(i,{mode:"modify",field_list_type:["edit"],from_item_id:s.item_id,from_module_id:s.module_id,module_id:m.module_id,project_id:s.project_id,page:m.page,schema_page:m.schema_page,type:"update_panel",primary_id:e.join(",")},function(){obj.reset_single_grid_data()})})},delete_single_grid_data:function(e){var i=$(e).attr("data-code"),t="Delete_"+Strack.string_ucwords(i)+"_Notice",_=Strack.deep_copy(m);_.from_module_id=0,_.from_item_id=0,Strack.ajax_grid_delete("single_main_datagrid_box","id",StrackLang[t],StrackPHP.deleteGridData,_)},reset_single_grid_data:function(){$("#single_main_datagrid_box").datagrid("reload")},create_entity_grid_data:function(e){var i=$(e).data("lang");Strack.item_operate_dialog(i,{mode:"create",field_list_type:["edit"],module_id:n.module_id,project_id:s.project_id,page:n.page,schema_page:n.schema_page,type:"add_panel"},function(){obj.reset_entity_grid_data()})},modify_entity_grid_data:function(e){var i=$(e).data("lang");Strack.get_datagrid_select_data("#main_datagrid_box",function(e){Strack.item_operate_dialog(i,{mode:"modify",field_list_type:["edit"],module_id:n.module_id,project_id:s.project_id,page:n.page,schema_page:n.schema_page,type:"update_panel",primary_id:e.join(",")},function(){obj.reset_entity_grid_data()})})},delete_entity_grid_data:function(e){var i=$(e).attr("data-code"),t="Delete_"+Strack.string_ucwords(i)+"_Notice";console.log(t),Strack.ajax_grid_delete("main_datagrid_box","id",StrackLang[t],StrackPHP.deleteGridData,n)},reset_entity_grid_data:function(){$("#main_datagrid_box").datagrid("reload")},add_link_onset:function(e){var i,t=Strack.validate_form("add_link_onset");200===parseInt(t.status)&&(i=t.data,$.ajax({type:"POST",url:StrackPHP.addEntityLinkOnset,data:i,dataType:"json",beforeSend:function(){$(s.id).prepend(Strack.loading_dom(s.loading_type),s.mask),$("#tab_onset").prepend(Strack.loading_dom("white","","onset_add"))},success:function(e){200===parseInt(e.status)?(Strack.top_message({bg:"g",msg:e.message}),$("#onset_select_list").combobox("destroy"),c={onset_id:e.data.onset_id,entity_id:e.data.link_id,module_id:i.onset_module_id,entity_module_id:e.data.module_id},b()):layer.msg(e.message,{icon:7,time:1200,anim:6}),$("#st-load_onset_add").remove()}}))}};var s=Strack.generate_hidden_param(),m={},n={},e={},c={};function a(e){Strack.active_select_tab("details_tab",e.tab_id),$(".details-page-main .pitem-wrap").hide();var i=$("#tab_single_grid");!function(e,i){var t=s.module_id+"-"+s.project_id+"-"+s.item_id+".html";i&&(t+="?"+i);history.replaceState(null,e,t)}("details","tab="+e.type+"-"+e.tab_id);var t,_,a,d,r={};switch(e.type){case"fixed":switch(t=$("#tab_"+e.tab_id),e.tab_id){case"base":i.show(),r={filter:{show:s.rule_base_panel_filter,edit:s.rule_base_modify_filter},sort:s.rule_base_sort,group:s.rule_base_group},g({create:s.rule_base_create,modify:s.rule_base_modify,import_excel:s.rule_base_import_excel,export_excel:s.rule_base_export_excel,action:s.rule_base_action,delete:s.rule_base_delete,modify_thumb:s.rule_base_modify_thumb,clear_thumb:s.rule_base_clear_thumb,sort:s.rule_base_sort,group:s.rule_base_group,manage_custom_fields:s.rule_base_manage_custom_fields,save_view:s.rule_base_save_view,save_as_view:s.rule_base_save_as_view,modify_view:s.rule_base_modify_view,delete_view:s.rule_base_delete_view,panel_filter:s.rule_base_panel_filter}),e.rule_side_thumb_modify=s.rule_base_modify_thumb,e.rule_side_thumb_clear=s.rule_base_clear_thumb,f(e,[{field:"id",value:s.item_id,condition:"NEQ",module_code:e.module_code,table:"Base"}],r);break;case"note":t.show(),(d=s).status="new",d.page_number=1,d.page_size=20,Strack.load_notes({page_id:".projpage-main",content_id:".task-mainwrap",avatar_id:"#comments_avatar",editor_id:"comments_editor",list_id:"comments_list",tab_id:"#details_tab",details_top_bar:!0,tab_bar_id:"task_hidebar"},d);break;case"info":t.show(),Strack.G.mainfieldsRequestParam={id:"#details_info",mask:"main_info",pos:"max",url:StrackPHP.getModuleItemInfo,data:{item_id:s.item_id,category:"main_field",schema_page:"project_"+s.module_code,project_id:s.project_id,module_id:s.module_id,module_code:s.module_code,module_type:s.module_type,template_id:s.template_id},loading_type:"white"},Strack.load_info_panel(Strack.G.mainfieldsRequestParam,function(e){Strack.set_info_main_show_mode_dom("details_main_info_title",e.fields_show_mode)});break;case"onset":t.show(),Strack.get_item_onset_data(s,function(e){var i;200===parseInt(e.status)?"yes"===e.data.has_link_onset?(c=e.data,b()):($("#onset_link_not_exit").show(),i=e.data,$("#onset_select_module_id").val(i.module_id),$("#onset_select_entity_id").val(i.entity_id),$("#onset_select_entity_module_id").val(i.entity_module_id),Strack.combobox_widget("#onset_select_list",{url:StrackPHP.getProjectOnsetList,valueField:"id",textField:"name",width:300,height:30,queryParams:{project_id:s.project_id}})):$("#onset_entity_not_exit").show()});break;case"file":i.show(),r={filter:{show:s.rule_file_panel_filter,edit:s.rule_file_modify_filter},sort:s.rule_file_sort,group:s.rule_file_group},g({create:s.rule_file_create,modify:s.rule_file_modify,import_excel:s.rule_file_import_excel,export_excel:s.rule_file_export_excel,action:s.rule_file_action,delete:s.rule_file_delete,modify_thumb:s.rule_file_modify_thumb,clear_thumb:s.rule_file_clear_thumb,sort:s.rule_file_sort,group:s.rule_file_group,manage_custom_fields:s.rule_file_manage_custom_fields,save_view:s.rule_file_save_view,save_as_view:s.rule_file_save_as_view,modify_view:s.rule_file_modify_view,delete_view:s.rule_file_delete_view,panel_filter:s.rule_file_panel_filter}),f(e,[{field:"module_id",value:s.module_id,condition:"EQ",module_code:e.tab_id,table:"File"},{field:"link_id",value:s.item_id,condition:"EQ",module_code:e.tab_id,table:"File"}],r);break;case"file_commit":i.show(),r={filter:{show:s.rule_file_commit_panel_filter,edit:s.rule_file_commit_modify_filter},sort:s.rule_file_commit_sort,group:s.rule_file_commit_group},g({create:s.rule_file_commit_create,modify:s.rule_file_commit_modify,import_excel:s.rule_file_commit_import_excel,export_excel:s.rule_file_commit_export_excel,action:s.rule_file_commit_action,delete:s.rule_file_commit_delete,modify_thumb:s.rule_file_commit_modify_thumb,clear_thumb:s.rule_file_commit_clear_thumb,sort:s.rule_file_commit_sort,group:s.rule_file_commit_group,manage_custom_fields:s.rule_file_commit_manage_custom_fields,save_view:s.rule_file_commit_save_view,save_as_view:s.rule_file_commit_save_as_view,modify_view:s.rule_file_commit_modify_view,delete_view:s.rule_file_commit_delete_view,panel_filter:s.rule_file_commit_panel_filter}),f(e,[{field:"module_id",value:s.module_id,condition:"EQ",module_code:e.tab_id,table:"File"},{field:"link_id",value:s.item_id,condition:"EQ",module_code:e.tab_id,table:"File"}],r);break;case"reference":t.show();break;case"history":t.show(),_=$("#tab_history"),a=$("#history_datagrid"),_.hasClass("load_active")?a.datagrid("reload"):(_.addClass("load_active"),a.datagrid({url:StrackPHP.getModuleItemHistory,height:Strack.panel_height(".task-history-wrap",0),singleSelect:!0,fitColumns:!1,adaptive:{dom:".task-history-wrap",min_width:510,exth:0},queryParams:s,frozenColumns:[[{field:"event_log_id",checkbox:!0}]],columns:[[{field:"id",title:StrackLang.ID,align:"center",width:120,frozen:"frozen",findex:0,formatter:function(e,i,t){return i.id}},{field:"operate",title:StrackLang.Operate,align:"center",width:120,frozen:"frozen",findex:1},{field:"type",title:StrackLang.Type,align:"center",width:180,frozen:"frozen",findex:2},{field:"record",title:StrackLang.Record,align:"center",width:600,frozen:"frozen",findex:3,formatter:function(e,i,t){return JSON.stringify(e)}},{field:"from",title:StrackLang.From,align:"center",width:120,frozen:"frozen",findex:4},{field:"created_by",title:StrackLang.Created_by,align:"center",width:160,frozen:"frozen",findex:5},{field:"created",title:StrackLang.Created,align:"center",width:180,frozen:"frozen",findex:6}]],pagination:!0,pageSize:100,pageList:[100,300,500],pageNumber:1,pagePosition:"bottom",remoteSort:!1}));break;case"correlation_base":i.show(),r={filter:{show:s.rule_correlation_task_panel_filter,edit:s.rule_correlation_task_modify_filter},sort:s.rule_correlation_task_sort,group:s.rule_correlation_task_group},g({create:s.rule_correlation_task_create,modify:s.rule_correlation_task_modify,import_excel:s.rule_correlation_task_import_excel,export_excel:s.rule_correlation_task_export_excel,action:s.rule_correlation_task_action,delete:s.rule_correlation_task_delete,modify_thumb:s.rule_correlation_task_modify_thumb,clear_thumb:s.rule_correlation_task_clear_thumb,sort:s.rule_correlation_task_sort,group:s.rule_correlation_task_group,manage_custom_fields:s.rule_correlation_task_manage_custom_fields,save_view:s.rule_correlation_task_save_view,save_as_view:s.rule_correlation_task_save_as_view,modify_view:s.rule_correlation_task_modify_view,delete_view:s.rule_correlation_task_delete_view,panel_filter:s.rule_correlation_task_panel_filter}),e.rule_side_thumb_modify=s.rule_correlation_task_modify_thumb,e.rule_side_thumb_clear=s.rule_correlation_task_clear_thumb,f(e,[{field:"id",value:s.item_id,condition:"NEQ",module_code:s.module_code,table:"Base"},{field:"entity_id",value:s.entity_id,condition:"EQ",module_code:s.module_code,table:"Base"}],r)}break;case"horizontal_relationship":case"be_horizontal_relationship":r={filter:{show:s.rule_horizontal_relationship_panel_filter,edit:s.rule_horizontal_relationship_modify_filter},sort:s.rule_horizontal_relationship_sort,group:s.rule_horizontal_relationship_group},e.src_module_id=e.module_id;var o=Strack.deep_copy(e);switch("horizontal_relationship"===e.type?(o.module_id=e.dst_module_id,o.module_code=e.dst_module_code):(o.module_id=e.module_id,o.dst_module_id=e.module_id,o.module_code=e.module_code),e.horizontal_type){case"fixed":"be_horizontal_relationship"===e.type&&g({create:"no",modify:"no",import_excel:"no",export_excel:"no",action:"no",delete:"no",modify_thumb:"no",clear_thumb:"no",sort:"no",group:"no",manage_custom_fields:"no",save_view:"no",save_as_view:"no",modify_view:"no",delete_view:"no",panel_filter:"no"}),o.rule_side_thumb_modify=s.rule_horizontal_relationship_modify_thumb,o.rule_side_thumb_clear=s.rule_horizontal_relationship_clear_thumb,u("single",o,e.type),i.show(),f(o,[],r);break;case"entity":u("entity",o,e.type),$("#tab_entity_grid").show(),p(o,r)}break;case"entity_child":r={filter:{show:s.rule_entity_child_panel_filter,edit:s.rule_entity_child_modify_filter},sort:s.rule_entity_child_sort,group:s.rule_entity_child_group};var l=Strack.deep_copy(e);l.src_module_id=l.dst_module_id,l.dst_module_id=l.module_id,u("entity",l,e.type),$("#tab_entity_grid").show(),p(l,r);break;case"other_page":(t=$("#tab_iframe_page")).show(),Strack.check_cloud_disk_endpoints("#tab_iframe_page",{dom_id:"#tab_iframe_page",type:"task",link_id:s.item_id})}}function u(e,i,t){"be_horizontal_relationship"===t?($("#single_grid_create_bnt").hide(),$("#entity_create_horizontal_bnt").hide(),$("#single_grid_create_horizontal").hide(),$("#single_grid_related_horizontal").hide()):"entity"===e?$("#entity_create_horizontal_bnt").show().attr("srcmoduleid",i.src_module_id).attr("dstmoduleid",i.dst_module_id).attr("dstmodulecode",i.dst_module_code).attr("variableid",i.variable_id).attr("horizontaltype",t).attr("srclinkid",s.item_id):($("#single_grid_create_bnt").hide(),$("#single_create_horizontal_bnt,#single_related_horizontal_bnt").attr("srcmoduleid",i.src_module_id).attr("dstmoduleid",i.dst_module_id).attr("dstmodulecode",i.dst_module_code).attr("variableid",i.variable_id).attr("horizontaltype",t).attr("srclinkid",s.item_id),$("#single_grid_create_horizontal").show(),$("#single_grid_related_horizontal").show())}function t(e,i){var t=$(e.dg_id),_=$(e.filter_id),a=$(e.delete_id);t.find(".proj-tb").attr("data-page",i.page).attr("data-schemapage",i.schema_page).attr("data-moduleid",i.module_id),_.attr("data-page",i.page).attr("data-schemapage",i.schema_page).attr("data-moduleid",i.module_id),a.attr("data-code",i.module_code),t.find(".create-bnt").attr("data-lang",i.lang).find(".stp-title").html(i.lang),t.find(".related-bnt").attr("data-lang",i.lang).find(".stp-title").html(i.lang),t.find(".all-action-slider").attr("data-moduleid",i.module_id),t.find(".modify-thumb-bnt").attr("data-moduleid",i.module_id),t.find(".clear-thumb-bnt").attr("data-moduleid",i.module_id),t.find(".datagrid-filter").attr("data-page",i.page).attr("data-schemapage",i.schema_page).attr("data-moduleid",i.module_id)}function g(e){$("#single_grid_create_horizontal").hide(),"yes"===e.create?$("#single_grid_create_bnt").show():$("#single_grid_create_bnt").hide(),"yes"===e.modify?$(".single_grid_modify_bnt").show():$(".single_grid_modify_bnt").hide(),"yes"===e.import_excel?$("#single_grid_import_excel_bnt").show():$("#single_grid_import_excel_bnt").hide(),"yes"===e.export_excel?$("#single_grid_export_excel_bnt").show():$("#single_grid_export_excel_bnt").hide(),"yes"===e.action?$(".single_grid_action_bnt").show():$(".single_grid_action_bnt").hide(),"yes"===e.delete?$(".single_grid_delete_bnt").show():$(".single_grid_delete_bnt").hide(),"yes"===e.modify_thumb?$("#single_grid_modify_thumb_bnt").show():$("#single_grid_modify_thumb_bnt").hide(),"yes"===e.clear_thumb?$("#single_grid_clear_thumb_bnt").show():$("#single_grid_clear_thumb_bnt").hide(),"yes"===e.sort?$("#single_grid_sort_bnt").show():$("#single_grid_sort_bnt").hide(),"yes"===e.group?$("#single_grid_group_bnt").show():$("#single_grid_group_bnt").hide(),"yes"===e.manage_custom_fields?$("#single_grid_manage_custom_fields_bnt").show():$("#single_grid_manage_custom_fields_bnt").hide(),"yes"===e.save_view?$("#single_grid_save_view_bnt").show():$("#single_grid_save_view_bnt").hide(),"yes"===e.save_as_view?$("#single_grid_save_as_view_bnt").show():$("#single_grid_save_as_view_bnt").hide(),"yes"===e.modify_view?$("#single_grid_modify_view_bnt").show():$("#single_grid_modify_view_bnt").hide(),"yes"===e.delete_view?$("#single_grid_delete_view_bnt").show():$("#single_grid_delete_view_bnt").hide(),"yes"===e.panel_filter?$(".single_filter_main").css("width",200).show():$(".single_filter_main").css("width",0).hide()}function f(d,e,r){var o="details_"+d.tab_id,l=e||[],i="horizontal_relationship"===d.type?"yes":"no",n=Strack.generate_schema_page(d.module_code);t({dg_id:"#single_datagrid_main",filter_id:"#single_filter_main",delete_id:"#single_grid_delete_item_bnt"},m={page:o,lang:d.name,schema_page:n,module_id:d.module_id,module_type:d.module_type,module_code:d.module_code,template_id:s.template_id,project_id:s.project_id,from_item_id:s.item_id,from_module_id:s.module_id,rule_tab_notes:s.rule_tab_notes,rule_tab_info:s.rule_tab_info,rule_tab_history:s.rule_tab_history,rule_tab_onset:s.rule_tab_onset,rule_tab_base:s.rule_tab_base,rule_tab_file:s.rule_tab_file,rule_tab_file_commit:s.rule_tab_file_commit,rule_tab_horizontal_relationship:s.rule_tab_horizontal_relationship,rule_tab_correlation_task:s.rule_tab_correlation_task,rule_tab_cloud_disk:s.rule_tab_cloud_disk,rule_template_fixed_tab:s.rule_template_fixed_tab,rule_side_thumb_modify:d.rule_side_thumb_modify,rule_side_thumb_clear:d.rule_side_thumb_clear}),Strack.load_grid_columns("#tab_single_grid",{loading_id:"#tab_single_grid",page:o,schema_page:n,module_id:d.module_id,is_horizontal_relationship:i,project_id:s.project_id,grid_id:"single_main_datagrid_box",view_type:"grid",temp_fields:{add:{},cut:{}}},function(e){var i=$("#tab_single_grid"),t=$("#single_main_datagrid_box"),_={},a={filter:{temp_fields:{add:{},cut:{}},group:e.grid.group_name,sort:e.grid.sort_config.sort_query,request:l,filter_input:e.grid.filter_config.filter_input,filter_panel:e.grid.filter_config.filter_panel,filter_advance:e.grid.filter_config.filter_advance},page:o,schema_page:n,module_id:d.module_id,project_id:s.project_id,item_id:s.item_id,module_code:d.tab_id,module_type:d.type,horizontal_type:d.horizontal_type,parent_module_id:s.module_id};i.hasClass("load_active")?(_={moduleId:d.module_id,projectId:s.project_id,queryParams:{filter_data:JSON.stringify(a)},panelConfig:{active_filter_id:e.grid.filter_config.filter_id},sortConfig:e.grid.sort_config,sortData:e.grid.sort_config.sort_data,renderNewPage:!0,toolbarConfig:{id:"single_datagrid_main",page:o,sortAllow:!0,groupAllow:!0,fieldAllow:!0,viewAllow:!0,actionAllow:!0},searchConfig:{id:"single_grid_search",bar_show:e.grid.filter_bar_show,filterBar:{main_dom:"single_datagrid_main",bar_dom:"single_filter_main"}},filterConfig:{id:"single_filter_main",schema_page:n,barParam:{}},authorityRules:r,columnsFieldConfig:e.grid.columnsFieldConfig,frozenColumns:e.grid.frozenColumns,columns:e.grid.columns,onDblClickRow:function(e,i){m.item_id=i.id,("entity"===m.module_type||0<=$.inArray(m.module_code,["base","correlation_base"]))&&Strack.open_datagrid_slider(m)}},$.isEmptyObject(e.grid.group_name)||(_.groupActive=!0,_.groupField=Strack.get_grid_group_field(e.grid.group_name).field,_.groupFormatter=function(e,i){return'<span class="">'+e+"( "+i.length+" )</span>"}),t.datagrid("setOptions",_).datagrid("reload")):(i.addClass("load_active"),_={url:StrackPHP.getDetailGridData,height:Strack.panel_height("#single_datagrid_main",0),view:scrollview,rowheight:50,differhigh:!1,singleSelect:!1,adaptive:{dom:"#single_datagrid_main",min_width:680,exth:0,domresize:1},ctrlSelect:!0,multiSort:!0,DragSelect:!0,queryParams:{filter_data:JSON.stringify(a)},panelConfig:{active_filter_id:e.grid.filter_config.filter_id},sortConfig:e.grid.sort_config,sortData:e.grid.sort_config.sort_data,moduleId:d.module_id,projectId:s.project_id,toolbarConfig:{id:"single_datagrid_main",page:o,sortAllow:!0,groupAllow:!0,fieldAllow:!0,viewAllow:!0,actionAllow:!0},searchConfig:{id:"single_grid_search",bar_show:e.grid.filter_bar_show,filterBar:{main_dom:"single_datagrid_main",bar_dom:"single_filter_main"}},filterConfig:{id:"single_filter_main",schema_page:n,barParam:{}},authorityRules:r,contextMenuData:{id:"st_menu_single",copy_id:"ac_copy_cell",edit_id:"#single_datagrid_main .edit-menu",data:[]},columnsFieldConfig:e.grid.columnsFieldConfig,frozenColumns:e.grid.frozenColumns,columns:e.grid.columns,toolbar:"#single_tb_grid",pagination:!0,pageNumber:1,pageSize:200,pageList:[100,200,300,400,500],pagePosition:"bottom",remoteSort:!1,onDblClickRow:function(e,i){m.item_id=i.id,("entity"===m.module_type||0<=$.inArray(m.module_code,["base","correlation_base"]))&&Strack.open_datagrid_slider(m)}},$.isEmptyObject(e.grid.group_name)||(_.groupActive=!0,_.groupField=Strack.get_grid_group_field(e.grid.group_name).field,_.groupFormatter=function(e,i){return'<span class="">'+e+"( "+i.length+" )</span>"}),t.datagrid(_).datagrid("enableCellEditing").datagrid("disableCellSelecting").datagrid("gotoCell",{index:0,field:"id"}).datagrid("columnMoving"))})}function p(d,r){var o="details_"+d.tab_id,e="horizontal_relationship"===d.type?"yes":"no",l=Strack.generate_schema_page(d.module_code);t({dg_id:"#grid_datagrid_main",filter_id:"#grid_filter_main",delete_id:"#delele_horizontal_relationship_bnt"},n={page:o,lang:d.name,schema_page:l,module_id:d.dst_module_id,module_type:d.module_type,module_code:d.module_code,template_id:s.template_id,project_id:s.project_id,from_item_id:s.item_id,from_module_id:s.module_id,rule_tab_notes:s.rule_tab_notes,rule_tab_info:s.rule_tab_info,rule_tab_history:s.rule_tab_history,rule_tab_onset:s.rule_tab_onset,rule_tab_base:s.rule_tab_base,rule_tab_file:s.rule_tab_file,rule_tab_cloud_disk:s.rule_tab_cloud_disk,rule_tab_file_commit:s.rule_tab_file_commit,rule_tab_horizontal_relationship:s.rule_tab_horizontal_relationship,rule_tab_correlation_task:s.rule_tab_correlation_task,rule_template_fixed_tab:s.rule_template_fixed_tab,rule_side_thumb_modify:s.rule_horizontal_relationship_modify_thumb,rule_side_thumb_clear:s.rule_horizontal_relationship_clear_thumb}),Strack.load_grid_columns("#tab_entity_grid",{loading_id:"#tab_entity_grid",page:o,schema_page:l,module_id:d.module_id,project_id:s.project_id,grid_id:"main_datagrid_box",is_horizontal_relationship:e,temp_fields:{add:{},cut:{}}},function(e){var i=$("#tab_entity_grid"),t=$("#main_datagrid_box"),_={},a={filter:{temp_fields:{add:{},cut:{}},group:e.grid.group_name,sort:e.grid.sort_config.sort_query,request:[],filter_input:e.grid.filter_config.filter_input,filter_panel:e.grid.filter_config.filter_panel,filter_advance:e.grid.filter_config.filter_advance},page:o,schema_page:l,module_id:d.module_id,project_id:s.project_id,item_id:s.item_id,module_code:d.module_code,module_type:d.type,horizontal_type:d.horizontal_type,parent_module_id:s.module_id};i.hasClass("load_active")?(_={moduleId:d.module_id,projectId:s.project_id,queryParams:{filter_data:JSON.stringify(a)},panelConfig:{active_filter_id:e.grid.filter_config.filter_id},sortConfig:e.grid.sort_config,sortData:e.grid.sort_config.sort_data,renderNewPage:!0,toolbarConfig:{id:"grid_datagrid_main",page:o,sortAllow:!0,groupAllow:!0,fieldAllow:!0,viewAllow:!0,stepAllow:!0,actionAllow:!0},searchConfig:{id:"main_grid_search",bar_show:e.grid.filter_bar_show,filterBar:{main_dom:"grid_datagrid_main",bar_dom:"grid_filter_main"}},filterConfig:{id:"grid_filter_main",schema_page:l,barParam:{}},authorityRules:r,columnsFieldConfig:e.grid.columnsFieldConfig,frozenColumns:e.grid.frozenColumns,columns:e.grid.columns,onDblClickRow:function(e,i){n.item_id=i.id,Strack.open_datagrid_slider(n)}},$.isEmptyObject(e.grid.group_name)||(_.groupActive=!0,_.groupField=Strack.get_grid_group_field(e.grid.group_name).field,_.groupFormatter=function(e,i){return'<span class="">'+e+"( "+i.length+" )</span>"}),t.datagrid("setOptions",_).datagrid("reload")):(i.addClass("load_active"),_={url:StrackPHP.getDetailGridData,height:Strack.panel_height("#grid_datagrid_main",0),view:scrollview,rowheight:50,differhigh:!0,singleSelect:!1,adaptive:{dom:"#grid_datagrid_main",min_width:680,exth:0,domresize:1},ctrlSelect:!0,multiSort:!0,DragSelect:!0,moduleId:d.module_id,projectId:s.project_id,queryParams:{filter_data:JSON.stringify(a)},panelConfig:{active_filter_id:e.grid.filter_config.filter_id},sortConfig:e.grid.sort_config,sortData:e.grid.sort_config.sort_data,toolbarConfig:{id:"grid_datagrid_main",page:o,sortAllow:!0,groupAllow:!0,fieldAllow:!0,viewAllow:!0,stepAllow:!0,actionAllow:!0},searchConfig:{id:"main_grid_search",bar_show:e.grid.filter_bar_show,filterBar:{main_dom:"grid_datagrid_main",bar_dom:"grid_filter_main"}},filterConfig:{id:"grid_filter_main",schema_page:l,barParam:{}},authorityRules:r,contextMenuData:{id:"st_menu_entity",copy_id:"ac_copy_cell",edit_id:"#grid_datagrid_main .edit-menu",data:[]},columnsFieldConfig:e.grid.columnsFieldConfig,frozenColumns:e.grid.frozenColumns,columns:e.grid.columns,toolbar:"#tb_grid",pagination:!0,pageNumber:1,pageSize:200,pageList:[100,200,300,400,500],pagePosition:"bottom",remoteSort:!1,onDblClickRow:function(e,i){n.item_id=i.id,Strack.open_datagrid_slider(n)}},$.isEmptyObject(e.grid.group_name)||(_.groupActive=!0,_.groupField=Strack.get_grid_group_field(e.grid.group_name).field,_.groupFormatter=function(e,i){return'<span class="">'+e+"( "+i.length+" )</span>"}),t.datagrid(_).datagrid("enableCellEditing").datagrid("disableCellSelecting").datagrid("gotoCell",{index:0,field:"id"}).datagrid("columnMoving"))})}function b(){$("#onset_entity_not_exit,#onset_link_not_exit").remove(),$("#onset_link_main").show(),(e=Strack.deep_copy(s)).category="detail_onset_field",e.module_id=c.entity_module_id,e.onset_id=c.onset_id,$("#onset_att_bnt").attr("data-linkid",c.onset_id).attr("data-moduleid",c.module_id),Strack.load_info_panel({id:"#onset_info",mask:"onset_info",pos:"onset",url:StrackPHP.getOnsetInfoData,data:e,loading_type:"white"},function(e){}),Strack.load_onset_attachment("#onset_reference",{module_id:c.module_id,link_id:c.onset_id})}$.ajax({type:"POST",url:StrackPHP.getDetailTopThumb,data:s,dataType:"json",beforeSend:function(){$(".item-thumb-warp").prepend(Strack.loading_dom("white","","thumb"))},success:function(e){var i,t,_=e.data;_.link_id=s.item_id,_.module_id=s.module_id,_.param.icon="icon-uniE61A",Strack.thumb_media_widget("#details_thumb",_,{modify_thumb:s.rule_thumb_modify,clear_thumb:s.rule_thumb_clear}),(i=_).has_media,t="",$("#hidebar_thumb").empty().append(Strack.build_thumb_dom(t,i.param.icon)),$("#st-load_thumb").remove()}}),Strack.G.topfieldsRequestParam={id:"#details_top_info",mask:"top_info",pos:"min",url:StrackPHP.getModuleItemInfo,data:{item_id:s.item_id,category:"top_field",schema_page:"project_"+s.module_code,project_id:s.project_id,module_id:s.module_id,module_code:s.module_code,module_type:s.module_type,template_id:s.template_id},loading_type:"white"},Strack.load_info_panel(Strack.G.topfieldsRequestParam,function(e){var i,t,_,a,d,r;"yes"===s.rule_prev_next_one&&(i=s,t=e.prev_and_next,_="",a=Strack.remove_html_ext(StrackPHP.details),d=0<t.prev?a+"/"+i.module_id+"-"+i.project_id+"-"+t.prev+".html":"javascript:;",r=0<t.next?a+"/"+i.module_id+"-"+i.project_id+"-"+t.next+".html":"javascript:;",_+='<a href="'+d+'" class="ui labeled icon button"><i class="left chevron icon"></i> '+StrackLang.Prev_One+'</a><a href="'+r+'" class="ui right labeled icon button">'+StrackLang.Next_One+' <i class="right chevron icon"></i></a>',$("#prev_next_bnt").html(_)),4===parseInt(s.module_id)&&"yes"===s.rule_is_my_task&&"yes"===s.rule_timelog&&Strack.init_timelog_bnt("#top_timelog_bnt",e.timelog)}),Strack.init_breadcrumb("item_breadcrumb",s,function(e){$("#hidebar_breadcrumb").html(e)}),s.position="details",Strack.init_tab_list("details_tab",s,function(e){!function(e){var i,t={},_=null;e.forEach(function(e){t[e.tab_id]=e,_=_||e.tab_id}),i=s.url_tab&&t[s.url_tab]?t[s.url_tab]:t[_];i&&a(i)}(e)})});